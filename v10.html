<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Estate | Global Luxury</title>

    <!-- FONTS: Classic Authority -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- ANIMATION ENGINE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="config.js"></script>

    <style>
        /* 
         * ----------------------------------------------------------
         * 0. PRELOADER
         * ----------------------------------------------------------
         */
        #preloader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--navy-deep);
            z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
            overflow: hidden;
        }
        .preloader-text {
            font-family: var(--font-serif);
            font-size: 2.5rem;
            color: var(--white);
            letter-spacing: 5px;
            text-transform: uppercase;
            position: relative;
            opacity: 0; /* Controlled by GSAP */
            transform: translateY(20px);
        }
        .preloader-line {
            width: 0%;
            height: 2px;
            background: var(--gold-accent);
            margin-top: 15px;
        }

        /* 
         * ----------------------------------------------------------
         * 1. THE "PLATINUM" PALETTE
         * ----------------------------------------------------------
         */
        :root {
            --navy-deep: #0a192f; /* Executive Blue */
            --navy-light: #112240;
            --platinum: #e6e6e6;
            --gold-accent: #c5a059;
            --white: #ffffff;
            --slate: #8892b0;
            
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Lato', sans-serif;
            
            --container-width: 1100px;
            --shadow-soft: 0 10px 30px -10px rgba(2, 12, 27, 0.1);
            --shadow-hard: 0 20px 50px -10px rgba(2, 12, 27, 0.3);
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            background-color: #f8f9fa;
            color: var(--navy-deep);
            font-family: var(--font-sans);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* 
         * ----------------------------------------------------------
         * 2. UI COMPONENTS
         * ----------------------------------------------------------
         */
        
        .container { max-width: var(--container-width); margin: 0 auto; padding: 0 20px; position: relative; z-index: 2; }
        
        h1, h2, h3, h4 { font-family: var(--font-serif); color: var(--navy-deep); margin: 0; font-weight: 700; }
        p { line-height: 1.8; color: #555; }

        .section-header { text-align: center; margin-bottom: 4rem; }
        .section-header span { 
            display: block; 
            font-family: var(--font-sans); 
            text-transform: uppercase; 
            letter-spacing: 3px; 
            font-size: 0.8rem; 
            color: var(--gold-accent); 
            margin-bottom: 1rem;
            font-weight: 700;
        }
        .section-header h2 { font-size: 3rem; position: relative; display: inline-block; }
        .section-header h2::after {
            content: ''; display: block; width: 60px; height: 3px; background: var(--navy-deep);
            margin: 20px auto 0;
        }

        /* Button Adjustment */
        .btn-classic {
            display: inline-block;
            width: auto; /* Reset width for desktop */
            min-width: 250px; /* Ensure minimum width */
            text-align: center;
            background: var(--navy-deep);
            color: var(--white);
            padding: 18px 40px;
            font-family: var(--font-sans);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(10, 25, 47, 0.2);
            text-decoration: none;
        }
        
        /* Hero-Specific Button (Gold) */
        #hero .btn-classic {
            background: var(--gold-accent);
            color: var(--navy-deep);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 10; /* Ensure top layer */
            border: 1px solid var(--gold-accent);
        }
        #hero .btn-classic:hover {
            background: var(--white);
            color: var(--navy-deep);
            transform: translateY(-3px);
        }
        
        /* Metallic Shine Effect */
        .btn-classic::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        .btn-classic:hover::before { left: 100%; }
        .btn-classic:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(10, 25, 47, 0.3); }

        /* Social Icons */
        .social-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 45px; height: 45px;
            border-radius: 50%;
            background: var(--white);
            color: var(--navy-deep);
            font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            text-decoration: none;
        }
        .social-icon:hover {
            background: var(--navy-deep);
            color: var(--white);
            transform: translateY(-3px);
        }

        /* 
         * ----------------------------------------------------------
         * 3. HEADER & NAV
         * ----------------------------------------------------------
         */
        .top-bar {
            background: var(--navy-deep);
            color: var(--white);
            padding: 10px 0;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        nav {
            background: var(--white);
            padding: 25px 0;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: 0.3s;
        }
        .nav-inner { display: flex; justify-content: space-between; align-items: center; }
        .brand-logo {
            font-family: var(--font-serif);
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--navy-deep);
            text-decoration: none;
            display: flex; align-items: center; gap: 10px;
        }
        .brand-logo i { color: var(--gold-accent); font-size: 1.4rem; }
        .nav-contact { font-weight: 700; color: var(--navy-deep); text-decoration: none; font-size: 0.9rem; }
        .nav-contact i { color: var(--gold-accent); margin-right: 8px; }

        /* 
         * ----------------------------------------------------------
         * 4. HERO (Redesigned: Cinematic Panel)
         * ----------------------------------------------------------
         */
        #hero {
            height: 90vh; /* Taller */
            position: relative;
            display: flex; align-items: center;
            overflow: hidden;
            color: var(--white);
        }
        .hero-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            z-index: 1;
        }
        /* Dark gradient overlay for depth */
        .hero-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, rgba(10,25,47,0.8) 0%, rgba(10,25,47,0.4) 50%, rgba(10,25,47,0.1) 100%);
            z-index: 2;
        }
        
        .hero-content-wrapper {
            position: relative; z-index: 3;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
        }

        .hero-panel {
            background: var(--navy-deep);
            opacity: 0.95;
            padding: 60px;
            max-width: 650px;
            border-left: 5px solid var(--gold-accent);
            box-shadow: 0 30px 60px rgba(0,0,0,0.5);
            position: relative;
            clip-path: inset(0 100% 0 0); /* Hidden initially for wipe effect */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 30px; /* Space for button below */
        }
        
        .hero-cta-container {
            max-width: 650px;
            width: 100%;
            opacity: 0; /* Hidden initially */
            transform: translateY(20px);
        }
        
        /* Decorative "Watermark" text behind */
        .hero-panel::before {
            content: '';
            position: absolute; top: 0; right: 0; width: 100px; height: 100px;
            background: linear-gradient(135deg, transparent 50%, var(--gold-accent) 50%);
            opacity: 0.1;
            z-index: 0;
        }
        
        /* Ensure content sits above watermark */
        .hero-panel > * { position: relative; z-index: 1; }

        .hero-badge {
            display: inline-block;
            font-family: var(--font-sans);
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--gold-accent);
            margin-bottom: 25px;
            position: relative;
            padding-left: 40px;
        }
        .hero-badge::before {
            content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
            width: 30px; height: 1px; background: var(--gold-accent);
        }

        #heroTitle {
            font-size: clamp(3rem, 6vw, 5rem);
            line-height: 1;
            margin-bottom: 30px;
            color: var(--white);
            text-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        #heroSubtitle {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #ccc;
            margin-bottom: 40px;
            border-left: 1px solid rgba(255,255,255,0.2);
            padding-left: 25px;
        }

        /* 
         * ----------------------------------------------------------
         * 5. FEATURES (The "Sheet")
         * ----------------------------------------------------------
         */
        section { padding: 100px 0; }
        .bg-white { background: var(--white); }

        .features-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px;
        }
        .feature-item {
            text-align: center;
            padding: 40px 20px;
            border: 1px solid #eee;
            transition: 0.3s;
        }
        .feature-item:hover { border-color: var(--gold-accent); transform: translateY(-5px); box-shadow: var(--shadow-soft); }
        .feature-icon { font-size: 2.5rem; color: var(--navy-deep); margin-bottom: 20px; }
        .feature-title { font-size: 1.2rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }

        /* 
         * ----------------------------------------------------------
         * 6. AGENT (The "Business Card")
         * ----------------------------------------------------------
         */
        .agent-card {
            background: var(--white);
            box-shadow: var(--shadow-hard);
            display: flex;
            flex-wrap: wrap;
        }
        .agent-photo {
            flex: 1; min-width: 300px; min-height: 500px;
            background-size: cover; background-position: center;
        }
        .agent-details {
            flex: 1; padding: 60px;
            min-width: 300px;
            display: flex; flex-direction: column; justify-content: center;
            background: url('https://www.transparenttextures.com/patterns/cream-paper.png'); /* Subtle texture */
        }
        
        /* Signature Font */
        .signature-text {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: var(--navy-deep);
            margin-top: 20px;
            transform: rotate(-5deg);
            display: inline-block;
            position: relative;
            opacity: 0; /* Hidden initially for animation */
        }

        /* 
         * ----------------------------------------------------------
         * 7. FORM (The "Contract")
         * ----------------------------------------------------------
         */
        .form-container {
            background: var(--white);
            padding: 60px;
            box-shadow: var(--shadow-soft);
            border-top: 5px solid var(--gold-accent);
            max-width: 700px; margin: 0 auto;
        }
        .form-group { margin-bottom: 25px; }
        .form-label {
            display: block; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;
            font-weight: 700; margin-bottom: 8px; color: var(--navy-deep);
        }
        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #eee;
            font-family: var(--font-sans);
            font-size: 1rem;
            color: var(--navy-deep);
            transition: 0.3s;
        }
        .form-input:focus { outline: none; border-color: var(--navy-deep); background: #fcfcfc; }
        
        /* Checkbox */
        .checkbox-wrapper { display: flex; gap: 15px; align-items: flex-start; margin-bottom: 30px; font-size: 0.9rem; color: #666; }
        .checkbox-wrapper input { margin-top: 4px; accent-color: var(--navy-deep); }

        /* 
         * ----------------------------------------------------------
         * 8. FOOTER
         * ----------------------------------------------------------
         */
        footer {
            background: var(--navy-deep); color: var(--white); padding: 60px 0; text-align: center;
        }
        .footer-logo { font-family: var(--font-serif); font-size: 2rem; margin-bottom: 20px; display: block; }
        .footer-links a { color: #ccc; margin: 0 15px; text-decoration: none; font-size: 0.9rem; transition: 0.3s; }
        .footer-links a:hover { color: var(--white); }

        /* 
         * ----------------------------------------------------------
         * 9. MODAL
         * ----------------------------------------------------------
         */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 25, 47, 0.9);
            z-index: 2000;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transition: 0.4s;
        }
        .modal-backdrop.visible { opacity: 1; pointer-events: all; }
        
        .modal-card {
            background: var(--white);
            width: 90%; max-width: 550px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            text-align: center;
            transform: translateY(30px); transition: 0.4s;
        }
        .modal-backdrop.visible .modal-card { transform: translateY(0); }
        
        .modal-btn {
            display: block; width: 100%;
            padding: 15px; margin-bottom: 10px;
            border: 1px solid #ddd; background: #f9f9f9;
            font-family: var(--font-sans); font-weight: 700; color: var(--navy-deep);
            cursor: pointer; transition: 0.2s;
        }
        .modal-btn:hover { background: var(--navy-deep); color: var(--white); border-color: var(--navy-deep); }

        /* 
         * ----------------------------------------------------------
         * 10. MOBILE OPTIMIZATION
         * ----------------------------------------------------------
         */
        @media (max-width: 768px) {
            nav { display: none !important; }
            
            /* Mobile Preloader */
            .preloader-text { font-size: 1.5rem; letter-spacing: 2px; text-align: center; padding: 0 20px; line-height: 1.4; }
            .preloader-line { width: 50px; }

            /* Mobile Hero */
            #hero { height: 100dvh; /* Use dynamic viewport height for mobile */ }
            .hero-panel {
                width: 90%;
                max-width: none;
                padding: 30px;
                margin: 0 auto;
                background: rgba(10, 25, 47, 0.85); /* Slightly more transparent on mobile */
                backdrop-filter: blur(5px); /* Add blur for readability */
                border-left: 3px solid var(--gold-accent);
            }
            
            #heroTitle { font-size: 2.5rem; margin-bottom: 15px; }
            #heroSubtitle { font-size: 1rem; margin-bottom: 25px; line-height: 1.6; }
            .hero-badge { font-size: 0.7rem; margin-bottom: 15px; }
            
            /* Button Adjustment */
            .btn-classic { width: 100%; padding: 15px 20px; font-size: 0.8rem; margin-top: 10px; }

            /* Section Adjustments */
            .section-header h2 { font-size: 2rem; }
            .agent-card { flex-direction: column; }
            .agent-photo { min-height: 350px; }
            .form-container { padding: 30px 20px; }
            
            /* Modal */
            .modal-card { padding: 30px 20px; width: 95%; }
        }

    </style>
</head>
<body>

    <!-- PRELOADER -->
    <div id="preloader">
        <div class="preloader-text" id="preloaderText">AGENT NAME</div>
        <div class="preloader-line" id="preloaderLine"></div>
    </div>

    <!-- CONFETTI CANVAS -->
    <canvas id="confetti-canvas" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:3000;"></canvas>

    <!-- TOP TICKER -->
    <div class="top-bar">
        <div class="container" id="topBarText">
            Global Luxury Division &nbsp;&nbsp;|&nbsp;&nbsp; Offering Memorandum No. 4921 &nbsp;&nbsp;|&nbsp;&nbsp; Strictly Confidential
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav id="navbar">
        <div class="container nav-inner">
            <div class="brand-logo">
                <span id="navRealtorName">REALTOR NAME</span>
            </div>
            <div class="nav-contact">
                <i class="fas fa-map-marker-alt"></i> <span id="navAddressText">Address</span>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <div id="hero">
        <div class="hero-bg" id="heroBg"></div>
        <div class="hero-overlay"></div>
        <div class="container hero-content-wrapper">
            <div class="hero-panel" id="heroPanel">
                <div class="hero-badge">Exclusive Listing</div>
                <h1 id="heroTitle">THE ESTATE</h1>
                <p id="heroSubtitle">An architectural triumph set upon the coast.</p>
            </div>
            <div class="hero-cta-container" id="heroCta">
                <a href="#contact" class="btn-classic">Get Full Home Package</a>
            </div>
        </div>
    </div>

    <!-- INTRODUCTION -->
    <section class="bg-white">
        <div class="container">
            <div class="section-header">
                <span>The Property</span>
                <h2>Receive the Full Home Package</h2>
            </div>
            <div class="features-grid" id="amenitiesGrid">
                <!-- JS Injected -->
            </div>
        </div>
    </section>

    <!-- THE AGENT -->
    <section style="background: #f0f2f5;">
        <div class="container">
            <div class="agent-card">
                <div class="agent-photo" id="agentPhotoBg"></div>
                <div class="agent-details">
                    <span style="text-transform:uppercase; letter-spacing:2px; color:#999; font-size:0.8rem;">Presented By</span>
                    <h2 style="font-size: 2.5rem; margin: 10px 0;" id="agentName">Agent Name</h2>
                    <h4 style="color: var(--gold-accent); margin-bottom: 20px;" id="agentTitle">Executive Director</h4>
                    <p id="agentBio" style="margin-bottom: 30px;">Bio text...</p>
                    
                    <!-- Cursive Signature -->
                    <div id="agentSignature" class="signature-text">Agent Name</div>

                    <div style="margin-top: 30px; font-size: 1rem;">
                         <div style="margin-bottom: 12px;">
                            <a href="#" id="agentEmail" style="color: var(--navy-deep); text-decoration: none; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-envelope" style="color: var(--gold-accent);"></i> <span id="agentEmailText">Email</span>
                            </a>
                        </div>
                        <div>
                            <a href="#" id="agentPhone" style="color: var(--navy-deep); text-decoration: none; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-phone-alt" style="color: var(--gold-accent);"></i> <span id="agentPhoneText">Phone</span>
                            </a>
                        </div>
                    </div>

                    <div id="agentSocials" style="margin-top: 30px; display: flex; gap: 15px;">
                        <!-- JS Injected -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTACT FORM -->
    <section class="bg-white" id="contact">
        <div class="container">
            <div class="section-header">
                <span>Access Details</span>
                <h2>Unlock Full Home Package</h2>
            </div>

            <div class="form-container">
                <p style="text-align:center; margin-bottom: 30px; font-style: italic;">Please complete the form below to immediately receive the full digital brochure, floor plans, and listing details.</p>
                
                <form id="leadForm">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="name" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="email" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Direct Line (Mobile)</label>
                        <input type="tel" id="phone" class="form-input" required inputmode="numeric">
                    </div>

                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="consent" required>
                        <label for="consent" id="consentLabel" style="font-size: 0.75rem; line-height: 1.5; display: block;">
                            I agree to be contacted... <!-- JS Injected -->
                        </label>
                    </div>

                    <button type="submit" class="btn-classic" style="width:100%;" id="submitBtn">
                        <span>Send Me the Package</span>
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer>
        <div class="container" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; text-align: left;">
            <div style="flex: 1; padding-right: 20px;">
                <span class="footer-logo" id="footerBrand">STERLING &amp; CO.</span>
                <p id="footerAddress" style="color: rgba(255,255,255,0.6); margin-bottom: 15px;">123 Luxury Lane</p>
                <div class="footer-links" style="margin: 0;">
                    <a href="#" id="privacyLink" style="margin-left: 0;">Privacy Policy</a>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <img id="footerLogo" src="" alt="Brokerage Logo" style="max-width: 120px; display: none;">
            </div>
        </div>
        <div class="container" style="margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center;">
            <p style="margin: 0; font-size: 0.7rem; opacity: 0.4;">&copy; <span id="year"></span> Global Luxury Division. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- MODAL -->
    <div class="modal-backdrop" id="modal">
        <div class="modal-card">
            <i class="fas fa-file-signature" style="font-size: 3rem; color: var(--navy-deep); margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 10px;" id="modalTitle">Buyer Profile</h3>
            <p style="margin-bottom: 30px; font-size: 0.9rem;">To better serve your needs, please indicate your current position.</p>
            <div id="modalOptions"></div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        /**
         * ==================================================================
         * STATE & CONFIG
         * ==================================================================
         */
        let storedInitialPayload = null;
        let collectedAnswers = {};

        /**
         * ==================================================================
         * INITIALIZATION
         * ==================================================================
         */
        document.addEventListener("DOMContentLoaded", () => {
            
            // 1. Check Config
            if (typeof config === 'undefined') {
                console.error("Config not loaded");
                return;
            }

            applyThemeColors();

            // 2. Populate Content
            populateV4Data();
            
            // 3. GSAP Animations
            gsap.registerPlugin(ScrollTrigger);

            // PRELOADER ANIMATION
            const tl = gsap.timeline();

            tl.to("#preloaderText", { opacity: 1, y: 0, duration: 1, ease: "power3.out" })
              .to("#preloaderLine", { width: "100px", duration: 1, ease: "power2.out" }, "-=0.5")
              .to("#preloaderText, #preloaderLine", { opacity: 0, y: -20, duration: 0.8, delay: 0.5, ease: "power2.in" })
              .to("#preloader", { yPercent: -100, duration: 1, ease: "power2.inOut" }); // Curtain up effect

            // HERO ANIMATION (New Sequence)
            // 1. Background Zoom starts immediately
            gsap.to("#heroBg", {
                scale: 1.1,
                duration: 10,
                ease: "none"
            });

            // 2. Panel Wipe In (starts after preloader curtain rises ~3s mark)
            // Mobile adjustment: Slightly faster or simpler if needed, but wipe works well.
            gsap.to("#heroPanel", {
                clipPath: "inset(0 0% 0 0)",
                duration: 1.5,
                ease: "power3.out",
                delay: 2.8 // Sync with preloader exit
            });

            // 3. Content Reveal inside panel (Staggered) + CTA button
            const heroElements = document.querySelectorAll("#heroPanel > *");
            gsap.from(heroElements, {
                y: 30,
                opacity: 0,
                duration: 0.8,
                stagger: 0.2,
                delay: 3.2,
                ease: "power2.out"
            });
            
            // Reveal CTA Button separate
            gsap.to("#heroCta", {
                y: 0,
                opacity: 1,
                duration: 1,
                delay: 3.8, // After panel content
                ease: "power3.out"
            });
            
            // Parallax Hero Scroll Effect (Disable on mobile to save battery/performance or reduce intensity)
            if (window.innerWidth > 768) {
                gsap.to("#heroBg", {
                    yPercent: 30,
                    ease: "none",
                    scrollTrigger: { trigger: "#hero", start: "top top", end: "bottom top", scrub: true }
                });
            }

            // Reveal Sections
            gsap.utils.toArray(".section-header, .feature-item, .agent-card").forEach(el => {
                gsap.from(el, {
                    opacity: 0, y: 40, duration: 1, ease: "power2.out",
                    scrollTrigger: { trigger: el, start: "top 85%" }
                });
            });

            // Signature Animation (Cursive Write-on effect)
            // We simulate writing by masking or simple opacity if clip-path is too complex for dynamic text width
            // Here using a simple wipe effect
            gsap.fromTo("#agentSignature", 
                { clipPath: "inset(0 100% 0 0)", opacity: 0 },
                { 
                    clipPath: "inset(0 0% 0 0)", 
                    opacity: 1, 
                    duration: 2.5, 
                    ease: "power2.out",
                    scrollTrigger: { trigger: ".agent-card", start: "top 70%" }
                }
            );
        });

        function applyThemeColors() {
            if (config.settings) {
                const root = document.documentElement;
                const s = config.settings;

                // 1. Primary (Deep Navy)
                if (s.primaryColor) {
                    root.style.setProperty('--navy-deep', s.primaryColor);
                    root.style.setProperty('--navy-light', s.primaryColor); // Map light variant to primary for consistency or derive if needed
                }

                // 2. Secondary (Gold)
                if (s.secondaryColor) {
                    root.style.setProperty('--gold-accent', s.secondaryColor);
                }

                // 3. Accent (Platinum/Slate)
                if (s.accentColor) {
                    root.style.setProperty('--platinum', s.accentColor);
                    root.style.setProperty('--slate', s.accentColor);
                }

                // 4. Neutral (White/Background)
                if (s.neutralColor) {
                    root.style.setProperty('--white', s.neutralColor);
                    // If neutral is dark (e.g. masculine theme), we might need to invert text colors, 
                    // but for now we map to the 'white' variable which controls backgrounds.
                }
            }
        }

        function populateV4Data() {
            // Meta
            document.title = `${config.meta.pageTitlePrefix} | Sterling & Co.`;
            
            // Preloader
            const preloaderText = document.getElementById('preloaderText');
            if(preloaderText) preloaderText.textContent = (config.realtor.fullName || 'THE ESTATE').toUpperCase();

            // Top Bar
            const topBarText = document.getElementById('topBarText');
            if(topBarText) {
                topBarText.innerHTML = `${(config.brokerage.name || '').toUpperCase()} &nbsp;&nbsp;|&nbsp;&nbsp; ${(config.realtor.fullName || '').toUpperCase()}`;
            }

            // Nav
            setText('navRealtorName', (config.realtor.fullName || 'REALTOR').toUpperCase());
            setText('navAddressText', config.property.streetAddress);
            
            // Hero
            const heroTitle = document.getElementById('heroTitle');
            if (heroTitle) heroTitle.textContent = (config.property.streetAddress || 'THE ESTATE').toUpperCase();
            
            const heroSubtitle = document.getElementById('heroSubtitle');
            if (heroSubtitle) heroSubtitle.textContent = config.property.heroSubtitle;

            const heroBg = document.getElementById('heroBg');
            if (heroBg && config.property.backgroundImageUrl) {
                heroBg.style.backgroundImage = `url(${config.property.backgroundImageUrl})`;
            }

            // Features / Amenities
            const grid = document.getElementById('amenitiesGrid');
            if (grid && config.openHouse.bundleItems) {
                grid.innerHTML = '';
                config.openHouse.bundleItems.forEach(item => {
                     grid.innerHTML += `
                        <div class="feature-item">
                            <i class="${item.icon} feature-icon"></i>
                            <div class="feature-title">${item.text}</div>
                        </div>`;
                });
            }

            // Agent
            setText('agentName', config.realtor.fullName);
            setText('agentTitle', config.realtor.title);
            setText('agentBio', config.realtor.bio);
            setText('agentSignature', config.realtor.fullName); // Set signature text
            
            const agentPhotoBg = document.getElementById('agentPhotoBg');
            if (agentPhotoBg && config.realtor.photoUrl) {
                agentPhotoBg.style.backgroundImage = `url(${config.realtor.photoUrl})`;
            }

            // Agent Contact
            setText('agentEmailText', config.realtor.email);
            const agentEmail = document.getElementById('agentEmail');
            if (agentEmail) agentEmail.href = `mailto:${config.realtor.email}`;

            setText('agentPhoneText', config.realtor.phone);
            const agentPhone = document.getElementById('agentPhone');
            if (agentPhone) agentPhone.href = `tel:${config.realtor.phone.replace(/\D/g,'')}`;
            
            // Agent Socials
            const agentSocials = document.getElementById('agentSocials');
            if (agentSocials && config.realtor.social) {
                agentSocials.innerHTML = '';
                Object.entries(config.realtor.social).forEach(([platform, url]) => {
                    if (url) {
                        const iconMap = { 
                            linkedin: 'fab fa-linkedin-in', 
                            instagram: 'fab fa-instagram', 
                            facebook: 'fab fa-facebook-f', 
                            twitter: 'fab fa-twitter', 
                            website: 'fas fa-globe',
                            youtube: 'fab fa-youtube',
                            tiktok: 'fab fa-tiktok'
                        };
                        const iconClass = iconMap[platform.toLowerCase()] || 'fas fa-link';
                        agentSocials.innerHTML += `
                            <a href="${url}" target="_blank" class="social-icon">
                                <i class="${iconClass}"></i>
                            </a>
                        `;
                    }
                });
            }

            // Footer / Consent
            setText('footerBrand', config.brokerage.name);
            setText('footerAddress', config.brokerage.address);
            setText('year', new Date().getFullYear());

             // Brokerage Logo
            const footerLogo = document.getElementById('footerLogo');
            if (footerLogo && config.brokerage.logoUrl) {
                footerLogo.src = config.brokerage.logoUrl;
                footerLogo.style.display = 'block';
            }

            // Legal Links & Consent
            const privacyLink = document.getElementById('privacyLink');
            let privacyUrl = "#";
            if (config.meta.privacyPolicyLink) {
                privacyUrl = config.meta.privacyPolicyLink;
                if(privacyLink) {
                    privacyLink.href = privacyUrl;
                    privacyLink.target = "_blank";
                }
            }
            
            const consentLabel = document.getElementById('consentLabel');
            if (consentLabel) {
                const brokerage = config.brokerage.name || 'the brokerage';
                const privacyHtml = `<a href="${privacyUrl}" target="_blank" style="color:inherit; text-decoration:underline;">Privacy Policy</a>`;
                
                consentLabel.innerHTML = `I agree to be contacted by ${brokerage} via call, email, and text. To opt-out, you can reply ‘stop’ at any time or click the unsubscribe link in the emails. Message and data rates may apply. ${privacyHtml}`;
            }
        }

        // Helpers
        function setText(id, txt) { const el = document.getElementById(id); if (el) el.textContent = txt; }


        /**
         * ==================================================================
         * FORM & LOGIC
         * ==================================================================
         */
        const form = document.getElementById('leadForm');
        
        // Phone Formatter
        document.getElementById('phone')?.addEventListener('input', function (e) {
            var x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
        });

        if (form) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Simulate processing
                const btn = document.getElementById('submitBtn');
                if (btn) {
                    btn.innerHTML = "<span>Processing...</span>";
                    btn.style.background = "#333";
                }

                // 1. Build Initial Payload
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const submittedAt = new Date().toISOString();

                const initialPayload = {
                    formType: "initial_contact",
                    email: email,
                    fullName: name,
                    phone: phone,
                    propertyAddress: config.property.streetAddress,
                    submittedAt: submittedAt,
                    questions: [],
                    agentEmail: config.realtor.email,
                    ...(config.deploymentInfo || {})
                };

                storedInitialPayload = initialPayload;

                // 2. Send to Webhook
                const visitorUrl = config.settings.visitorWebhookUrl;
                if (visitorUrl) {
                    try {
                        fetch(visitorUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(initialPayload)
                        }); // Fire and forget
                    } catch (err) {
                        console.error(err);
                    }
                }

                setTimeout(() => {
                    showModal(0);
                }, 1000);
            });
        }

        function showModal(index) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const optionsDiv = document.getElementById('modalOptions');
            
            modal.classList.add('visible');
            optionsDiv.innerHTML = '';

            // Guard
            const questions = config.modalQuestions || [];

            if(index < questions.length) {
                const q = questions[index];
                title.innerText = q.questionText;
                
                q.options.forEach(opt => {
                    const val = opt.value || opt;
                    const txt = opt.text || opt;
                    
                    const b = document.createElement('button');
                    b.className = 'modal-btn';
                    b.innerText = txt;
                    b.onclick = () => {
                        collectedAnswers[q.id] = val;
                        showModal(index + 1);
                    };
                    optionsDiv.appendChild(b);
                });
            } else {
                finish();
            }
        }

        async function finish() {
            // 1. Process Answers
            const questions = config.modalQuestions || [];
            const modalQuestionResponses = [];

             for (const [qId, answerVal] of Object.entries(collectedAnswers)) {
                const qObj = questions.find(q => q.id === qId);
                if (qObj) {
                    const optObj = qObj.options.find(o => o.value === answerVal);
                    modalQuestionResponses.push({
                        question: qObj.questionText,
                        answer: optObj ? optObj.text : answerVal
                    });
                }
            }

            // 2. Build Final Payload
            const finalPayload = {
                ...(storedInitialPayload || {}),
                formType: "modal_answers",
                submittedAt: new Date().toISOString(),
                questions: modalQuestionResponses
            };

            // 3. Send to Webhook
            const visitorUrl = config.settings.visitorWebhookUrl;
            if (visitorUrl) {
                try {
                    await fetch(visitorUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(finalPayload)
                    });
                } catch (err) {
                    console.error("Final submit error", err);
                }
            }

            // 4. Update UI
            const modalCard = document.querySelector('.modal-card');
            modalCard.innerHTML = `
                <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--navy-deep); margin-bottom: 20px;"></i>
                <h2>Inquiry Received</h2>
                <p>The brochure has been dispatched to your email address.</p>
                <button onclick="location.reload()" class="btn-classic" style="margin-top:20px;">Close</button>
            `;
            fireConfetti();
        }

        function fireConfetti() {
            const end = Date.now() + 3000;
            // Use config colors or fallback
            const colors = config.settings.confettiColors || ['#0a192f', '#c5a059', '#e6e6e6'];
            
            (function frame() {
                confetti({
                    particleCount: 3,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: colors,
                    shapes: ['square']
                });
                confetti({
                    particleCount: 3,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: colors,
                    shapes: ['square']
                });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

    </script>
</body>
</html>
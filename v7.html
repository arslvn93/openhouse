<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Residence | Modern Dark</title>

    <!-- FONTS: Tech & Modern -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" type="image/x-icon" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/svgs/solid/house-signal.svg">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- LOAD CONFIG -->
    <script src="config.js"></script>

    <style>
        /* 
         * DYNAMIC THEME ENGINE
         */
        :root {
            --bg: #080808;
            --surface: #121212;
            --text: #ffffff;
            --text-dim: #888888;
            
            /* Default Brand Color (Overwritten by JS) */
            --brand: #ffffff; 
            
            --border: rgba(255, 255, 255, 0.1);
            --font-main: 'Outfit', sans-serif;
            --font-tech: 'Space Mono', monospace;
            
            --ease-tech: cubic-bezier(0.22, 1, 0.36, 1);
        }

        * { box-sizing: border-box; cursor: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-main);
            overflow-x: hidden;
            opacity: 0; /* Wait for config load */
            transition: opacity 0.5s ease;
        }

        /* BACKGROUND GRID */
        .grid-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.05; pointer-events: none; z-index: -1;
        }
        
        /* VIGNETTE */
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent 0%, var(--bg) 120%);
            pointer-events: none; z-index: 0;
        }

        /* CUSTOM CURSOR */
        .cursor-ring {
            position: fixed; top: 0; left: 0; width: 20px; height: 20px;
            border: 1px solid var(--brand); border-radius: 50%;
            pointer-events: none; z-index: 9999;
            transform: translate(-50%, -50%); transition: width 0.2s, height 0.2s;
        }
        .cursor-dot {
            position: fixed; top: 0; left: 0; width: 4px; height: 4px;
            background: var(--brand); border-radius: 50%;
            pointer-events: none; z-index: 9999;
            transform: translate(-50%, -50%);
        }
        .cursor-ring.hover { width: 50px; height: 50px; background: rgba(255,255,255,0.05); border-color: var(--text); }

        /* UTILS */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 5vw; position: relative; z-index: 2; }
        .tech-text { font-family: var(--font-tech); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; color: var(--brand); }
        img { display: block; width: 100%; height: auto; object-fit: cover; }

        /* LOADER */
        .system-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .loader-bar {
            width: 200px; height: 2px; background: var(--surface); margin-top: 20px;
            position: relative; overflow: hidden;
        }
        .loader-progress {
            position: absolute; top: 0; left: 0; height: 100%; width: 0%;
            background: var(--brand); transition: width 0.1s;
        }

        /* NAV */
        nav {
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 30px 5vw;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100; mix-blend-mode: difference;
        }
        .nav-logo { font-weight: 700; font-size: 1.5rem; letter-spacing: -1px; text-transform: uppercase; }

        /* HERO */
        .hero { min-height: 100vh; display: flex; align-items: center; padding-top: 10vh; }
        .hero-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 5vw; align-items: center; width: 100%; }
        
        .hero-title {
            font-size: clamp(3rem, 8vw, 7rem); line-height: 0.9;
            font-weight: 700; text-transform: uppercase; letter-spacing: -0.03em;
            margin-bottom: 2rem;
        }
        .hero-title span { display: block; }
        .highlight { color: transparent; -webkit-text-stroke: 1px var(--brand); }
        
        .hero-img-box {
            position: relative; width: 100%; height: 70vh;
            border: 1px solid var(--border);
            padding: 10px; /* Frame effect */
        }
        .hero-img-box::after {
            content: ''; position: absolute; top: -1px; right: -1px;
            width: 20px; height: 20px;
            border-top: 2px solid var(--brand); border-right: 2px solid var(--brand);
        }
        .hero-img { width: 100%; height: 100%; filter: grayscale(50%); transition: 0.5s; }
        .hero-img-box:hover .hero-img { filter: grayscale(0%); }

        /* DATA GRID (Bundle) */
        .data-section { padding: 15vh 0; }
        .data-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px; margin-top: 4rem;
        }
        .data-card {
            background: var(--surface); border: 1px solid var(--border);
            padding: 3rem 2rem; position: relative; transition: 0.3s;
            min-height: 250px;
            display: flex; flex-direction: column; justify-content: center; align-items: flex-start;
            overflow: hidden;
        }
        .data-card:hover { border-color: var(--brand); transform: translateY(-5px); }
        .data-card::before {
            content:''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--brand); transform: scaleX(0); transform-origin: left; transition: 0.3s;
        }
        .data-card:hover::before { transform: scaleX(1); }
        
        .card-icon { font-size: 1.5rem; color: var(--brand); margin-bottom: 1.5rem; }
        .card-title { font-family: var(--font-tech); font-size: 1.2rem; margin-bottom: 0.5rem; color: #fff; }
        .card-sub { font-size: 0.8rem; color: var(--text-dim); }

        /* AGENT DOSSIER */
        .agent-section { padding: 10vh 0; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .agent-layout { display: grid; grid-template-columns: 300px 1fr; gap: 4rem; align-items: center; }
        
        .agent-photo-wrap {
            position: relative; width: 100%; height: 400px;
        }
        .agent-photo-wrap img {
            width: 100%; height: 100%; object-fit: cover;
            filter: contrast(110%) grayscale(20%);
        }
        .scan-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--brand); box-shadow: 0 0 10px var(--brand);
            animation: scan 3s infinite linear; opacity: 0.5;
        }
        @keyframes scan { 0% {top:0;} 100% {top:100%;} }

        .agent-info h2 { font-size: 3rem; margin-bottom: 10px; }
        .agent-links { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        .contact-detail { 
            font-size: 1rem; color: var(--text); text-decoration: none; 
            display: flex; align-items: center; gap: 10px;
        }
        .contact-detail:hover { color: var(--brand); }
        
        .social-links { display: flex; gap: 20px; margin-top: 20px; }
        .social-icon { font-size: 1.5rem; color: var(--text-dim); transition: 0.3s; }
        .social-icon:hover { color: var(--brand); transform: translateY(-3px); }

        .tech-btn {
            display: inline-block; padding: 15px 30px;
            border: 1px solid var(--border); color: var(--text);
            font-family: var(--font-tech); font-size: 0.8rem; text-transform: uppercase;
            text-decoration: none; transition: 0.3s;
        }
        .tech-btn:hover { border-color: var(--brand); color: var(--brand); background: rgba(255,255,255,0.02); }

        /* ACCESS TERMINAL (Form) */
        .form-section { padding: 15vh 0; display: flex; justify-content: center; }
        .terminal {
            width: 100%; max-width: 600px;
            background: var(--surface); border: 1px solid var(--border);
            padding: 40px; position: relative;
        }
        .terminal::after {
            content: 'SECURE CONNECTION'; position: absolute; top: -10px; left: 20px;
            background: var(--bg); padding: 0 10px; font-family: var(--font-tech); font-size: 0.7rem; color: var(--brand);
        }

        .input-group { margin-bottom: 20px; position: relative; }
        .input-group label {
            display: block; font-family: var(--font-tech); font-size: 0.7rem; color: var(--text-dim); margin-bottom: 8px;
        }
        .tech-input {
            width: 100%; background: var(--bg); border: 1px solid var(--border);
            padding: 15px; color: var(--text); font-family: var(--font-main); font-size: 1rem;
            transition: 0.3s;
        }
        .tech-input:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 15px var(--brand); }

        .submit-btn {
            width: 100%; padding: 20px; background: var(--brand); color: #000;
            font-family: var(--font-tech); font-weight: 700; text-transform: uppercase; letter-spacing: 2px;
            border: none; cursor: pointer; transition: 0.3s; margin-top: 20px;
        }
        .submit-btn:hover { filter: brightness(1.2); box-shadow: 0 0 20px var(--brand); }

        .checkbox-wrapper { display: flex; gap: 10px; align-items: flex-start; margin-top: 20px; font-size: 0.8rem; color: var(--text-dim); }
        .checkbox-wrapper input { accent-color: var(--brand); }
        .checkbox-wrapper a { color: var(--text); text-decoration: none; border-bottom: 1px solid var(--brand); }

        /* FOOTER */
        footer {
            padding: 40px 5vw 20px; border-top: 1px solid var(--border);
            display: flex; flex-direction: column; gap: 15px; align-items: center; text-align: center;
            font-family: var(--font-tech); font-size: 0.75rem; color: var(--text-dim);
            background: linear-gradient(to bottom, var(--bg), var(--surface));
        }
        .footer-logo { 
            max-height: 40px; max-width: 150px; width: auto; 
            margin-bottom: 5px; opacity: 0.9; 
            object-fit: contain;
        }
        .footer-links {
            display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap;
        }
        .footer-links a { 
            color: var(--text-dim); text-decoration: none; 
            border-bottom: 1px solid transparent; transition: 0.3s; 
            font-size: 0.7rem; letter-spacing: 1px; text-transform: uppercase;
        }
        .footer-links a:hover { color: var(--brand); border-color: var(--brand); }
        .footer-brand-text { font-size: 0.8rem; color: var(--text); font-weight: 700; letter-spacing: 1px; }
        .footer-address { opacity: 0.6; max-width: 400px; line-height: 1.4; font-size: 0.7rem; }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            z-index: 5000; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.5s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .modal-content {
            width: 90%; max-width: 500px; background: var(--surface);
            border: 1px solid var(--brand); padding: 40px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        
        .option-btn {
            display: block; width: 100%; padding: 15px; margin-bottom: 10px;
            background: transparent; border: 1px solid var(--border); color: var(--text);
            font-family: var(--font-tech); text-transform: uppercase; cursor: pointer; transition: 0.3s;
        }
        .option-btn:hover { border-color: var(--brand); color: var(--brand); box-shadow: inset 0 0 20px rgba(255,255,255,0.05); }

        /* MOBILE */
        @media(max-width: 768px) {
            nav { display: none; }
            .hero-grid, .agent-layout { grid-template-columns: 1fr; }
            .hero-img-box { height: 50vh; order: -1; }
            .hero-title { font-size: 3.5rem; }
            footer { flex-direction: column; gap: 20px; }
        }
    </style>
</head>
<body>

    <!-- FX LAYERS -->
    <div class="grid-bg"></div>
    <div class="vignette"></div>
    <div class="cursor-ring"></div>
    <div class="cursor-dot"></div>
    <canvas id="confetti-canvas" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:6000;"></canvas>

    <!-- SYSTEM LOADER -->
    <div class="system-loader">
        <div class="tech-text" id="loaderText">INITIALIZING...</div>
        <div class="loader-bar"><div class="loader-progress"></div></div>
    </div>

    <!-- MAIN CONTENT -->
    <main>
        
        <!-- NAV -->
        <nav>
            <div class="nav-logo" id="navBrand"></div>
            <div class="tech-text" id="navAddress"></div>
        </nav>

        <!-- HERO -->
        <section class="hero">
            <div class="container hero-grid">
                <div>
                    <div class="tech-text" style="margin-bottom: 20px;">:: EXCLUSIVE LISTING</div>
                    <h1 class="hero-title" id="dynamicTitle"></h1> <!-- Populated -->
                    <p style="font-size: 1.2rem; color: var(--text-dim); margin-bottom: 40px; max-width: 500px;" id="heroSubtitle"></p>
                    <div class="tech-text" id="propAddress"></div>
                </div>
                <div class="hero-img-box">
                    <img src="" id="heroImg" class="hero-img"> <!-- Populated -->
                </div>
            </div>
        </section>

        <!-- DATA GRID (Amenities) -->
        <section class="data-section">
            <div class="container">
                <div style="border-left: 2px solid var(--brand); padding-left: 20px;">
                    <h2 style="font-size: 2rem; text-transform: uppercase;">Full Home Package</h2>
                    <p class="tech-text" style="margin-top: 10px;">Exclusive Access</p>
                </div>
                <div class="data-grid" id="amenityGrid">
                    <!-- Populated -->
                </div>
            </div>
        </section>

        <!-- AGENT DOSSIER -->
        <section class="agent-section">
            <div class="container agent-layout">
                <div class="agent-photo-wrap">
                    <div class="scan-line"></div>
                    <img src="" id="realtorPhoto"> <!-- Populated -->
                </div>
                <div class="agent-info">
                    <div class="tech-text" style="margin-bottom: 10px;">// AUTHORIZED AGENT</div>
                    <h2 id="realtorName"></h2> <!-- Populated -->
                    <div id="realtorTitle" class="tech-text" style="margin-bottom: 20px; font-size: 1rem;"></div>
                    <p style="color: var(--text-dim); line-height: 1.6; margin-bottom: 30px;" id="realtorBio"></p>
                    
                    <div class="agent-links" id="contactLinks">
                        <!-- Populated -->
                    </div>
                </div>
            </div>
        </section>

        <!-- ACCESS TERMINAL -->
        <section class="form-section" id="access">
            <div class="terminal">
                <h2 style="font-size: 2rem; margin-bottom: 30px; text-align: center;">UNLOCK FULL HOME PACKAGE</h2>
                
                <form id="techForm">
                    <div class="input-group">
                        <label>FULL NAME</label>
                        <input type="text" id="fullName" class="tech-input hover-target" required autocomplete="name">
                    </div>
                    <div class="input-group">
                        <label>EMAIL ADDRESS</label>
                        <input type="email" id="email" class="tech-input hover-target" required autocomplete="email">
                    </div>
                    <div class="input-group">
                        <label>PHONE NUMBER</label>
                        <input type="tel" id="phone" class="tech-input hover-target" required autocomplete="tel" inputmode="numeric">
                    </div>

                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="consentCheckbox" required class="hover-target">
                        <label for="consentCheckbox">
                            AUTHORIZE DATA TRANSMISSION TO <span id="consentBrokerage" style="color:var(--brand);"></span>. <a href="#" id="privacyLink">PROTOCOL DETAILS</a>.
                        </label>
                    </div>

                    <button type="submit" class="submit-btn hover-target" id="submitBtn">SEND ME THE PACKAGE</button>
                </form>
            </div>
        </section>

        <!-- FOOTER -->
        <footer>
            <img src="" id="footerLogo" class="footer-logo" style="display:none;" alt="Brokerage Logo">
            <div id="footerBrand" class="footer-brand-text"></div>
            <div id="footerAddress" class="footer-address"></div>
            <div class="footer-links">
                <a href="#" id="footerPrivacy">PRIVACY POLICY</a>
                <span style="color:var(--border);">|</span>
                <span>© <span id="year"></span> SYSTEM LOCKED</span>
            </div>
        </footer>

    </main>

    <!-- MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div id="modalInner"></div>
        </div>
    </div>

    <script>
        /**
         * ==================================================================
         * 1. CONFIG FALLBACK (Safety Net)
         * ==================================================================
         */
        if (typeof config === 'undefined') {
            window.config = {
                meta: { titlePrefix: "System", privacyPolicyLink: "#" },
                property: { streetAddress: "1400 Pacific Heights", heroSubtitle: "Advanced living systems engaged.", backgroundImageUrl: "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?q=80&w=2671&auto=format&fit=crop" },
                realtor: { fullName: "Agent Name", bio: "Top Producer.", phone: "555-0123", email: "agent@email.com", photoUrl: "https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=800", social: { linkedin: "#" } },
                brokerage: { name: "Brokerage Inc", address: "Beverly Hills", logoUrl: "" },
                openHouse: { bundleItems: [{ icon: "fa-file-code", text: "Schematics" }, { icon: "fa-map-marker-alt", text: "Coordinates" }] },
                settings: { visitorWebhookUrl: "", confettiColors: ['#00ffcc', '#ffffff'] },
                modalQuestions: [{ id: "q1", questionText: "Status?", options: [{ text: "Buyer", value: "buyer" }] }]
            };
        }

        /**
         * ==================================================================
         * 2. DYNAMIC BRANDING ENGINE
         * ==================================================================
         */
        function applyBranding() {
            const cfg = (typeof config !== 'undefined') ? config : window.config;
            const colors = cfg.settings.confettiColors;
            // Use the first color in the array as the Brand Accent
            if (colors && colors.length > 0) {
                document.documentElement.style.setProperty('--brand', colors[0]);
            }
        }

        /**
         * ==================================================================
         * 3. INIT
         * ==================================================================
         */
        document.addEventListener("DOMContentLoaded", () => {
            applyBranding();
            applyThemeColors();
            populateContent();
            runLoader();
            initAnimations();
            setupForm();
        });

        function applyThemeColors() {
            const cfg = (typeof config !== 'undefined') ? config : window.config;
            if (cfg && cfg.settings) {
                const root = document.documentElement;
                if (cfg.settings.primaryColor) root.style.setProperty('--text', cfg.settings.primaryColor);
                if (cfg.settings.secondaryColor) root.style.setProperty('--brand', cfg.settings.secondaryColor);
                if (cfg.settings.accentColor) root.style.setProperty('--border', cfg.settings.accentColor);
                if (cfg.settings.neutralColor) root.style.setProperty('--bg', cfg.settings.neutralColor);
            }
        }

        function populateContent() {
            const cfg = (typeof config !== 'undefined') ? config : window.config;

            // Title Logic (Split by Space for styling)
            const words = cfg.property.streetAddress.split(' ');
            let titleHtml = '';
            words.forEach(w => titleHtml += `<span>${w}</span>`);
            document.getElementById('dynamicTitle').innerHTML = titleHtml;

            // Text Data
            document.title = cfg.meta.pageTitlePrefix || cfg.meta.titlePrefix;
            
            // Top Nav: Realtor Name & Property Address
            document.getElementById('navBrand').innerText = (cfg.realtor.fullName || "AGENT").toUpperCase();
            document.getElementById('navAddress').innerText = cfg.property.streetAddress.toUpperCase();

            document.getElementById('loaderText').innerText = `LOADING ${cfg.property.streetAddress.toUpperCase()}...`;
            document.getElementById('heroSubtitle').innerText = cfg.property.heroSubtitle;
            document.getElementById('propAddress').innerText = `LOC: ${cfg.property.streetAddress}`;
            document.getElementById('heroImg').src = cfg.property.backgroundImageUrl;

            // Grid
            const grid = document.getElementById('amenityGrid');
            if(cfg.openHouse && cfg.openHouse.bundleItems) {
                cfg.openHouse.bundleItems.forEach(item => {
                    grid.innerHTML += `
                        <div class="data-card hover-target" onclick="document.getElementById('access').scrollIntoView({behavior:'smooth'})">
                            <i class="fas ${item.icon} card-icon"></i>
                            <div class="card-title">${item.text}</div>
                            <div class="card-sub">INCLUDED IN PACKAGE</div>
                        </div>
                    `;
                });
            }

            // Agent
            const r = cfg.realtor;
            document.getElementById('realtorName').innerText = r.fullName.toUpperCase();
            if(r.title) document.getElementById('realtorTitle').innerText = r.title.toUpperCase();
            document.getElementById('realtorBio').innerText = r.bio;
            document.getElementById('realtorPhoto').src = r.photoUrl;

            // Contact Links (Full Text) & Socials
            const links = document.getElementById('contactLinks');
            let socialHtml = '<div class="social-links">';
            
            // Social Mapping
            const socialMap = {
                facebook: 'fa-facebook',
                instagram: 'fa-instagram',
                linkedin: 'fa-linkedin',
                twitter: 'fa-twitter',
                youtube: 'fa-youtube',
                website: 'fa-globe'
            };

            if(r.social) {
                for (const [key, url] of Object.entries(r.social)) {
                    const iconClass = socialMap[key.toLowerCase()] || 'fa-link';
                    socialHtml += `<a href="${url}" target="_blank" class="social-icon hover-target"><i class="fab ${iconClass}"></i></a>`;
                }
            }
            socialHtml += '</div>';

            links.innerHTML = `
                <a href="mailto:${r.email}" class="contact-detail hover-target"><i class="fas fa-envelope"></i> ${r.email}</a>
                <a href="tel:${r.phone}" class="contact-detail hover-target"><i class="fas fa-phone"></i> ${r.phone}</a>
                ${socialHtml}
            `;

            // Form Consent Text
            const privacyUrl = cfg.meta.privacyPolicyLink || '#';
            const brokerageName = cfg.brokerage.name;
            const consentLabel = document.querySelector('label[for="consentCheckbox"]');
            consentLabel.innerHTML = `
                Send me the Full Home Package and authorize contact by ${brokerageName} via call, email, and text. 
                To opt-out, you can reply ‘stop’ at any time or click the unsubscribe link in the emails. 
                Message and data rates may apply. <a href="${privacyUrl}" target="_blank">Privacy Policy</a>
            `;

            // Footer
            if(cfg.brokerage.logoUrl) {
                const fLogo = document.getElementById('footerLogo');
                fLogo.src = cfg.brokerage.logoUrl;
                fLogo.style.display = 'block';
            } else {
                document.getElementById('footerBrand').innerText = cfg.brokerage.name;
            }
            
            document.getElementById('footerAddress').innerText = cfg.brokerage.address;
            
            const fPrivacy = document.getElementById('footerPrivacy');
            fPrivacy.href = privacyUrl;
            fPrivacy.target = "_blank";
            
            document.getElementById('year').innerText = new Date().getFullYear();
        }

        // --- ANIMATION ---
        function runLoader() {
            const bar = document.querySelector('.loader-progress');
            const loader = document.querySelector('.system-loader');
            
            // Fake loading progress
            let width = 0;
            const interval = setInterval(() => {
                width += Math.random() * 10;
                if(width > 100) width = 100;
                bar.style.width = width + '%';
                
                if(width === 100) {
                    clearInterval(interval);
                    gsap.to(loader, { yPercent: -100, duration: 0.8, ease: "power4.inOut", delay: 0.2 });
                    document.body.style.opacity = 1;
                    revealContent();
                }
            }, 50);
        }

        function revealContent() {
            // Scramble Text Effect
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
            const title = document.getElementById('dynamicTitle');
            // Note: A full scramble requires complex JS, simplified here with GSAP opacity
            
            gsap.from("#dynamicTitle span", { opacity:0, x:50, stagger:0.1, duration:1, delay:0.5, ease:"power2.out" });
            gsap.from(".hero-img-box", { scale:0.8, opacity:0, duration:1.5, delay:0.2, ease:"expo.out" });
        }

        function initAnimations() {
            const lenis = new Lenis({ duration: 1.2 });
            function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
            requestAnimationFrame(raf);

            gsap.registerPlugin(ScrollTrigger);

            // Card Stagger
            gsap.from(".data-card", {
                y: 50, stagger: 0.1, duration: 0.8,
                scrollTrigger: { trigger: ".data-section", start: "top 75%" }
            });
        }

        // --- FORM LOGIC ---
        let storedPayload = null;
        let collectedAnswers = {};

        function setupForm() {
            const cfg = (typeof config !== 'undefined') ? config : window.config;

            document.getElementById('phone').addEventListener('input', function (e) {
                var x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,4})/);
                e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
            });

            document.getElementById('techForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = document.getElementById('submitBtn');
                btn.innerText = "TRANSMITTING...";
                
                storedPayload = {
                    formType: "initial_contact",
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    propertyAddress: cfg.property.streetAddress,
                    agentEmail: cfg.realtor.email,
                    submittedAt: new Date().toISOString()
                };

                if (cfg.settings.visitorWebhookUrl) {
                    try {
                        await fetch(cfg.settings.visitorWebhookUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(storedPayload),
                            mode: 'cors'
                        });
                    } catch(err) {}
                }

                setTimeout(() => showModalStep(0), 800);
            });
        }

        function showModalStep(index) {
            const cfg = (typeof config !== 'undefined') ? config : window.config;
            const modal = document.getElementById('modalOverlay');
            const inner = document.getElementById('modalInner');
            modal.classList.add('active');
            inner.innerHTML = '';

            if (index < cfg.modalQuestions.length) {
                const q = cfg.modalQuestions[index];
                let html = `
                    <div class="tech-text" style="margin-bottom:20px;">QUERY ${index+1}/${cfg.modalQuestions.length}</div>
                    <h3 style="font-size: 1.5rem; margin-bottom: 30px;">${q.questionText}</h3>
                `;
                q.options.forEach(opt => {
                    const txt = opt.text || opt;
                    const val = opt.value || opt;
                    html += `<div class="option-btn hover-target" onclick="handleAnswer('${q.id}', '${val}', ${index})">${txt}</div>`;
                });
                inner.innerHTML = html;
            } else {
                finishSequence();
            }
        }

        window.handleAnswer = (qid, val, idx) => {
            collectedAnswers[qid] = val;
            showModalStep(idx + 1);
        };

        function finishSequence() {
            const cfg = (typeof config !== 'undefined') ? config : window.config;
            const finalPayload = {
                ...storedPayload,
                formType: "modal_answers",
                questions: Object.keys(collectedAnswers).map(k => ({ questionId: k, answer: collectedAnswers[k] }))
            };

            if (cfg.settings.visitorWebhookUrl) {
                fetch(cfg.settings.visitorWebhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(finalPayload),
                    mode: 'cors'
                });
            }

            document.getElementById('modalInner').innerHTML = `
                <h2 style="font-size: 2.5rem; margin-bottom: 20px; color: var(--brand);">PACKAGE UNLOCKED</h2>
                <p style="color: #888; margin-bottom: 30px;">CHECK YOUR EMAIL FOR THE FULL HOME PACKAGE.</p>
                <button onclick="location.reload()" class="submit-btn hover-target">RETURN TO LISTING</button>
            `;
            
            // Neon Confetti
            const c = cfg.settings.confettiColors || ['#ffffff'];
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: c });
        }

        // CUSTOM CURSOR
        const ring = document.querySelector('.cursor-ring');
        const dot = document.querySelector('.cursor-dot');
        
        document.addEventListener('mousemove', (e) => {
            gsap.to(ring, { x: e.clientX, y: e.clientY, duration: 0.15 });
            gsap.to(dot, { x: e.clientX, y: e.clientY, duration: 0.05 });
        });
        
        document.addEventListener('mouseover', (e) => {
            if (e.target.classList.contains('hover-target') || e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'A') {
                ring.classList.add('hover');
            } else {
                ring.classList.remove('hover');
            }
        });

    </script>
</body>
</html>
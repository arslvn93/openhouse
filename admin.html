<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-T-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Configuration</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; }
        h2 { border-bottom: 1px solid #eee; padding-bottom: 10px; margin-top: 30px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"],
        input[type="url"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea { min-height: 80px; resize: vertical; }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        fieldset { border: 1px solid #ddd; padding: 15px; margin-top: 20px; border-radius: 4px; }
        legend { font-weight: bold; font-size: 1.1em; padding: 0 5px; }
        .form-group { margin-bottom: 15px; }
        .bundle-item, .modal-question-group {
            border: 1px dashed #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .modal-option-group {
            padding-left: 20px;
            border-left: 2px solid #eee;
            margin-top: 5px;
        }
        #message { margin-top: 15px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container hidden" id="formContainer">
        <h1>Admin Configuration</h1>
        <form id="configForm">
            <!-- Property Details -->
            <fieldset>
                <legend>Property Details</legend>
                <div class="form-group">
                    <label for="streetAddress">Street Address:</label>
                    <input type="text" id="streetAddress" name="streetAddress">
                </div>
                <div class="form-group">
                    <label for="city">City:</label>
                    <input type="text" id="city" name="city">
                </div>
                <div class="form-group">
                    <label for="cityStateZip">City, State/Province Zip/Postal:</label>
                    <input type="text" id="cityStateZip" name="cityStateZip">
                </div>
                <div class="form-group">
                    <label for="heroSubtitle">Hero Subtitle:</label>
                    <textarea id="heroSubtitle" name="heroSubtitle"></textarea>
                </div>
                <div class="form-group">
                    <label for="homeType">Home Type:</label>
                    <input type="text" id="homeType" name="homeType">
                </div>
                <div class="form-group">
                    <label for="listingPrice">Listing Price:</label>
                    <input type="text" id="listingPrice" name="listingPrice">
                </div>
                <div class="form-group">
                    <label for="beds">Beds:</label>
                    <input type="text" id="beds" name="beds">
                </div>
                <div class="form-group">
                    <label for="baths">Baths:</label>
                    <input type="text" id="baths" name="baths">
                </div>
                <div class="form-group">
                    <label for="backgroundImageUrl">Background Image URL:</label>
                    <input type="url" id="backgroundImageUrl" name="backgroundImageUrl">
                </div>
                <div class="form-group">
                    <label for="brandedMediaLink">Branded Media Link (e.g., Brokerage Site):</label>
                    <input type="url" id="brandedMediaLink" name="brandedMediaLink">
                </div>
                <div class="form-group">
                    <label for="listingUrl">Listing URL:</label>
                    <input type="url" id="listingUrl" name="listingUrl">
                </div>
                <div class="form-group">
                    <label for="floorplanUrl">Floorplan URL:</label>
                    <input type="url" id="floorplanUrl" name="floorplanUrl">
                </div>
                <div class="form-group">
                    <label for="comparables">Comparables (URLs, one per line):</label>
                    <textarea id="comparables" name="comparables"></textarea>
                </div>
                <div class="form-group">
                    <label for="virtualTourUrl">Virtual Tour URL:</label>
                    <input type="url" id="virtualTourUrl" name="virtualTourUrl">
                </div>
                <div class="form-group">
                    <label for="openHouseDate">Open House Date:</label>
                    <input type="date" id="openHouseDate" name="openHouseDate">
                </div>
                <div class="form-group">
                    <label for="benefits">Benefits (one per line):</label>
                    <textarea id="benefits" name="benefits"></textarea>
                </div>
                <div class="form-group">
                    <label for="keyFeature">Key Feature:</label>
                    <input type="text" id="keyFeature" name="keyFeature">
                </div>
                <div class="form-group">
                    <label for="neighbourhood">Neighbourhood Description:</label>
                    <textarea id="neighbourhood" name="neighbourhood"></textarea>
                </div>
            </fieldset>

            <!-- Realtor Details -->
            <fieldset>
                <legend>Realtor Details</legend>
                <div class="form-group">
                    <label for="realtorFullName">Full Name:</label>
                    <input type="text" id="realtorFullName" name="realtorFullName">
                </div>
                <div class="form-group">
                    <label for="realtorFirstName">First Name (for display):</label>
                    <input type="text" id="realtorFirstName" name="realtorFirstName">
                </div>
                <div class="form-group">
                    <label for="realtorTitle">Title:</label>
                    <input type="text" id="realtorTitle" name="realtorTitle">
                </div>
                <div class="form-group">
                    <label for="realtorPhone">Phone:</label>
                    <input type="tel" id="realtorPhone" name="realtorPhone">
                </div>
                <div class="form-group">
                    <label for="realtorEmail">Email:</label>
                    <input type="email" id="realtorEmail" name="realtorEmail">
                </div>
                <div class="form-group">
                    <label for="realtorBio">Bio:</label>
                    <textarea id="realtorBio" name="realtorBio"></textarea>
                </div>
                <div class="form-group">
                    <label for="realtorPhotoUrl">Photo URL:</label>
                    <input type="url" id="realtorPhotoUrl" name="realtorPhotoUrl">
                </div>
                <fieldset>
                    <legend>Social Media</legend>
                    <div class="form-group">
                        <label for="socialFacebook">Facebook URL:</label>
                        <input type="url" id="socialFacebook" name="socialFacebook">
                    </div>
                    <div class="form-group">
                        <label for="socialInstagram">Instagram URL:</label>
                        <input type="url" id="socialInstagram" name="socialInstagram">
                    </div>
                    <div class="form-group">
                        <label for="socialWebsite">Website URL:</label>
                        <input type="url" id="socialWebsite" name="socialWebsite">
                    </div>
                </fieldset>
            </fieldset>

            <!-- Brokerage Details -->
            <fieldset>
                <legend>Brokerage Details</legend>
                <div class="form-group">
                    <label for="brokerageName">Name:</label>
                    <input type="text" id="brokerageName" name="brokerageName">
                </div>
                <div class="form-group">
                    <label for="brokerageLogoUrl">Logo URL:</label>
                    <input type="url" id="brokerageLogoUrl" name="brokerageLogoUrl">
                </div>
                <div class="form-group">
                    <label for="brokerageAddress">Address:</label>
                    <input type="text" id="brokerageAddress" name="brokerageAddress">
                </div>
            </fieldset>

            <!-- Open House Bundle Items -->
            <fieldset>
                <legend>Open House Bundle Items (Max 8)</legend>
                <div id="bundleItemsContainer">
                    <!-- JavaScript will populate this -->
                </div>
            </fieldset>

            <!-- Meta Information -->
            <fieldset>
                <legend>Meta/Site Information</legend>
                <div class="form-group">
                    <label for="metaPageTitlePrefix">Page Title Prefix:</label>
                    <input type="text" id="metaPageTitlePrefix" name="metaPageTitlePrefix">
                </div>
                <div class="form-group">
                    <label for="metaNavBrandLogoText">Navigation Brand/Logo Text:</label>
                    <input type="text" id="metaNavBrandLogoText" name="metaNavBrandLogoText">
                </div>
                <div class="form-group">
                    <label for="metaPrivacyPolicyLink">Privacy Policy Link:</label>
                    <input type="url" id="metaPrivacyPolicyLink" name="metaPrivacyPolicyLink">
                </div>
                <div class="form-group">
                    <label for="metaTermsLink">Terms & Conditions Link:</label>
                    <input type="url" id="metaTermsLink" name="metaTermsLink">
                </div>
            </fieldset>

            <!-- Settings -->
            <fieldset>
                <legend>Settings</legend>
                <div class="form-group">
                    <label for="settingsWebhookUrl">Webhook URL (read-only):</label>
                    <input type="url" id="settingsWebhookUrl" name="settingsWebhookUrl" readonly>
                </div>
                <div class="form-group">
                    <label for="settingsConfettiColors">Confetti Colors (hex codes, one per line):</label>
                    <textarea id="settingsConfettiColors" name="settingsConfettiColors"></textarea>
                </div>
            </fieldset>

            <!-- Modal Questions -->
            <fieldset>
                <legend>Modal Questions (First 2 Questions, Max 4 Options Each)</legend>
                <div id="modalQuestionsContainer">
                    <!-- JavaScript will populate this -->
                </div>
            </fieldset>

            <button type="submit">Save Configuration</button>
            <div id="message"></div>
        </form>
    </div>

    <script>
        const initialConfig = {
          property: {
            streetAddress: "11 Glen Abbey Tr",
            city: "Vaughan",
            cityStateZip: "Vaughan, ON L4H 4K4",
            heroSubtitle: "Epitome of Luxury and Grandeur in the exclusive Kleinburg Area. Register to receive the complete property compendium, virtual tour, and comparables.",
            homeType: "Freehold",
            listingPrice: "$3,148,800",
            beds: "4+2 Beds",
            baths: "6",
            backgroundImageUrl: "https://images.unsplash.com/photo-1613490493576-7fde63acd811?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2071&q=80",
            brandedMediaLink: "https://istreetrealty.ca/",
            listingUrl: "https://app.realmmlp.ca/s?active=TREB-N11969605&is_map_search=true&ne_lat=43.83479654795312&ne_lng=-79.6384699174286&offset=1&q=treb%2Favailability%3AA%257Cclass%3AFREE%257CsaleOrRent%3ASALE%257CgeoAnd%3AY&sw_lat=43.82978137717714&sw_lng=-79.64690278257142&z=17",
            floorplanUrl: "https://www.realtor.ca/l/bQDuo/ka",
            comparables: [
              "https://www.realtor.ca/real-estate/27976844/71-nave-street-vaughan-kleinburg-kleinburg",
              "https://www.realtor.ca/real-estate/28231738/49-appleyard-avenue-vaughan-kleinburg-kleinburg",
              "https://www.realtor.ca/real-estate/27785830/52-rolling-green-court-vaughan-kleinburg-kleinburg",
              "https://app.realmmlp.ca/s?%24orderby=price&active=TREB-N11889978&is_map_search=true&ne_lat=43.83801356606088&ne_lng=-79.63496530607858&offset=1&q=treb%2Favailability%3AU%257Cclass%3AFREE%257CsaleOrRent%3ASALE%257CgeoAnd%3AY%257Cstatus%3ASLD%257CsaleDate%3A%253E%253D11%252F01%252F2024&sw_lat=43.82798334378021&sw_lng=-79.65183103636423&z=16",
              "https://app.realmmlp.ca/s?%24orderby=price&active=TREB-N11245503&is_map_search=true&ne_lat=43.83801356606088&ne_lng=-79.63496530607858&offset=1&q=treb%2Favailability%3AU%257Cclass%3AFREE%257CsaleOrRent%3ASALE%257CgeoAnd%3AY%257Cstatus%3ASLD%257CsaleDate%3A%253E%253D11%252F01%252F2024&sw_lat=43.82798334378021&sw_lng=-79.65183103636423&z=16",
              "https://app.realmmlp.ca/s?%24orderby=price&active=TREB-N9387032&is_map_search=true&ne_lat=43.83801356606088&ne_lng=-79.63496530607858&offset=1&q=treb%2Favailability%3AU%257Cclass%3AFREE%257CsaleOrRent%3ASALE%257CgeoAnd%3AY%257Cstatus%3ASLD%257CsaleDate%3A%253E%253D11%252F01%252F2024&sw_lat=43.82798334378021&sw_lng=-79.65183103636423&z=16"
            ],
            virtualTourUrl: "https://www.realtor.ca/l/bQDuo/ka",
            openHouseDate: "2025-05-10",
            benefits: [
              "Completely finished Luxurious turn-key home including Finished Basement with kitchen and 2 extra bedrooms and Full Landscaping with pool and cabana with outdoor bathroom",
              "New high-end finishes including Full Kitchen, Herringbone flooring, Appliances (SubZero 72\"  Side-by-side Fridge/Freezer, Wolf 48 Stove, Bosh DW), Quartz countertop, 2 new furnaces and Air Conditioner, and Full Interlock driveway",
              "3-Car garage, 10 foot ceilings on main, and 9 foot ceilings in basement and 2nd floor"
            ],
            keyFeature: "Epitome of Luxury and Grandeur",
            neighbourhood: "Exclusive Kleinburg Area home surrounded by Luxury homes, schools, parks, and nature."
          },
          realtor: {
            fullName: "iStreet Realty Group",
            firstName: "iStreet Realty Group",
            title: "Brokerage Team",
            phone: "416-410-2880",
            email: "rick@istreetrealty.ca",
            bio: "At iStreet Realty Group we are built on integrity, insight, and innovation. We combine decades of real estate expertise with cutting-edge technology to deliver unmatched support, transparency, and results for our clients. With over 40 years of hands-on real estate experience and extensive corporate backgrounds, our managing partners provide a balanced and strategic approach to Residential, Commercial, and Investment properties. We prioritize clear communication and use the latest market insights to guide every client toward success‚Äîwhether buying, selling, or investing. At iStreet Realty Inc., we‚Äôre more than real estate experts‚Äîwe‚Äôre your trusted partner in building your future.",
            photoUrl: "https://prod-files-secure.s3.us-west-2.amazonaws.com/8e0c10a0-da43-409c-b191-91135b7161ff/c68f7f74-a1cf-4af6-a787-cf6c973b557f/headshot.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SHELW62K%2F20250507%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250507T170650Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICV%2BOaqi7RPztQxN5a%2FGejkDLIE3hxa2%2B5iGWHzFqEZNAiEAidVh%2F6%2Bjec4PhZIKX2ChTRekJv%2B3rnOHphQR4vg%2FCssq%2FwMIYhAAGgw2Mzc0MjMxODM4MDUiDA476Nbg%2BGT5dHgmqSrcA10aAxmAeT253CIIPiFG5yASIrwckicz31P6GjplCBkvpFVmdhWqxVS%2BDTmMhMwyVJbSBrZjjmjSSx8kuKkv3QvBlKFnbD3pPohdHohFWcJzAbKsJa3baU2HWtjIU5sk%2FMg96ImmUaa%2F5XjJ7UIh5FCj%2B%2B4jiKLddTwBI4mlYxoEmVC2ZlDyvdkc8Yxz7Wb9wFfT5HKCqRiIY8hFfgjt0Fj%2BQEVmLI3%2B0fPANaYm89ANwqk08QM2MCG1%2F4OG%2BEwCWyuQMpFC7IVFT%2BqZj5ETCokIYe8IOocy4BSPbpY3XEo8i66Wa0ExZAgIglx3TeDifd8LG1MZx%2FbPcCc6urXo84U3jRtVgmzxa5HZ4xUQAK%2BwHbSR4Lu%2F5Vy%2FXvIlSeLJv4lUynUGtUsWA67kVI%2BOmpYS1Cxa9DNqMhu4MUz7yEB%2BLhcGn6%2BGTpQXt%2BKLRxBRY1ugQmTs%2BuStJPQu2ZQ2Kq9XGdLcGV10zfNNE3wC2udbNSq7iMfprH5V8j5OXfUFbNZWW46Nc3HWUdTGcxndJbE%2BrF15eDMNNNxrl69zpSsJjI2evvIfqnINHwugRe5UF9Zaqun4WbFpnW6ir5nVV9qoRFpdwoLEO2xtV2Ue7iB2b8hukVf0fpeFNmnXMO%2Bc7sAGOqUBMcBGoVjWMPXnPEh2WdJxbMcBhGjqOP5dnDAYDKBlKDym8CzxPKjbdu02gbgQ%2FSG1UNowQWeRuqNgPpJ4NcE%2B2K6aBJ7bLGWeKrAc5b97%2Fj5ZChwGzXuzda%2B8xygpNWvAxVYlXb0eHzNgiCgOYSFgDfHu2iSjfXDjTJ3GAavRSSoP2fUdX9qi4btuZtUJKW8TYOmprId%2F1gVEiiPiJqLMS1j%2Bnkb%2B&X-Amz-Signature=333c98803bc8c782fbdda1c3837e1d40c35cfe3536b7f5c258cc50475bd5ab1c&X-Amz-SignedHeaders=host&x-id=GetObject",
            social: {
              facebook: "https://www.facebook.com/iStreetRealty",
              instagram: "https://www.instagram.com/istreetrealtygroup",
              website: "https://istreetrealty.ca/"
            }
          },
          brokerage: {
            name: "HomeLife Partners",
            logoUrl: "https://prod-files-secure.s3.us-west-2.amazonaws.com/8e0c10a0-da43-409c-b191-91135b7161ff/2ad1f3a4-7cea-45f4-bef2-b56767bf550e/brokeragelogo.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SHELW62K%2F20250507%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250507T170650Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICV%2BOaqi7RPztQxN5a%2FGejkDLIE3hxa2%2B5iGWHzFqEZNAiEAidVh%2F6%2Bjec4PhZIKX2ChTRekJv%2B3rnOHphQR4vg%2FCssq%2FwMIYhAAGgw2Mzc0MjMxODM4MDUiDA476Nbg%2BGT5dHgmqSrcA10aAxmAeT253CIIPiFG5yASIrwckicz31P6GjplCBkvpFVmdhWqxVS%2BDTmMhMwyVJbSBrZjjmjSSx8kuKkv3QvBlKFnbD3pPohdHohFWcJzAbKsJa3baU2HWtjIU5sk%2FMg96ImmUaa%2F5XjJ7UIh5FCj%2B%2B4jiKLddTwBI4mlYxoEmVC2ZlDyvdkc8Yxz7Wb9wFfT5HKCqRiIY8hFfgjt0Fj%2BQEVmLI3%2B0fPANaYm89ANwqk08QM2MCG1%2F4OG%2BEwCWyuQMpFC7IVFT%2BqZj5ETCokIYe8IOocy4BSPbpY3XEo8i66Wa0ExZAgIglx3TeDifd8LG1MZx%2FbPcCc6urXo84U3jRtVgmzxa5HZ4xUQAK%2BwHbSR4Lu%2F5Vy%2FXvIlSeLJv4lUynUGtUsWA67kVI%2BOmpYS1Cxa9DNqMhu4MUz7yEB%2BLhcGn6%2BGTpQXt%2BKLRxBRY1ugQmTs%2BuStJPQu2ZQ2Kq9XGdLcGV10zfNNE3wC2udbNSq7iMfprH5V8j5OXfUFbNZWW46Nc3HWUdTGcxndJbE%2BrF15eDMNNNxrl69zpSsJjI2evvIfqnINHwugRe5UF9Zaqun4WbFpnW6ir5nVV9qoRFpdwoLEO2xtV2Ue7iB2b8hukVf0fpeFNmnXMO%2Bc7sAGOqUBMcBGoVjWMPXnPEh2WdJxbMcBhGjqOP5dnDAYDKBlKDym8CzxPKjbdu02gbgQ%2FSG1UNowQWeRuqNgPpJ4NcE%2B2K6aBJ7bLGWeKrAc5b97%2Fj5ZChwGzXuzda%2B8xygpNWvAxVYlXb0eHzNgiCgOYSFgDfHu2iSjfXDjTJ3GAavRSSoP2fUdX9qi4btuZtUJKW8TYOmprId%2F1gVEiiPiJqLMS1j%2Bnkb%2B&X-Amz-Signature=e466bae68474221e32325602983600a018965c4df078456a0f297b44b54458c4&X-Amz-SignedHeaders=host&x-id=GetObject",
            address: "3850 Steeles Avenue W. Unit 6, Woodbridge, Ontario"
          },
          openHouse: {
            bundleItems: [
              { icon: "fas fa-ruler-combined", text: "Architectural Floor Plan: ", link: "https://www.realtor.ca/l/bQDuo/ka" },
              { icon: "fas fa-star", text: "Benefit: Completely finished Luxurious turn-key home with finished basement, pool, cabana/bathroom, landscaping" },
              { icon: "fas fa-check-circle", text: "Benefit: New High-End Finishes: Kitchen, Herringbone flooring, SubZero/Wolf/Bosh appliances, 2 new furnaces & AC, interlock driveway" },
              { icon: "fas fa-car", text: "3-Car Garage, 10 ft main ceilings, 9 ft 2nd/basement" },
              { icon: "fas fa-camera-retro", text: "High-Resolution Photo Album and Virtual Tour", link: "https://www.realtor.ca/l/bQDuo/ka" },
              { icon: "fas fa-film", text: "Cinematic Property Tour Video", link: "https://www.realtor.ca/l/bQDuo/ka" },
              { icon: "fas fa-map-location-dot", text: "Kleinburg Neighbourhood Insights & Recent Sales", comparables: [ // This nested comparables will not be editable in the simple form
                "https://www.realtor.ca/real-estate/27976844/71-nave-street-vaughan-kleinburg-kleinburg",
                "https://www.realtor.ca/real-estate/28231738/49-appleyard-avenue-vaughan-kleinburg-kleinburg",
                "https://www.realtor.ca/real-estate/27785830/52-rolling-green-court-vaughan-kleinburg-kleinburg"
                ] },
              { icon: "fas fa-key", text: "Early Access Notifications for New Kleinburg Listings" }
            ]
          },
          meta: {
            pageTitlePrefix: "üè° iStreet Open House",
            navBrandLogoText: "iStreet Realty Group",
            privacyPolicyLink: "https://istreetrealty.ca/privacy-policy/",
            termsLink: "#terms"
          },
          settings: {
            webhookUrl: "https://n8n.salesgenius.co/webhook/openhouse",
            confettiColors: ['#6187a7', '#f0e9d6', '#ffffff', '#83a363', '#d9ac68']
          },
          modalQuestions: [
            {
              id: "agent_status",
              questionText: "Are you currently exploring homes with a real estate agent?",
              options: [
                { value: "committed", text: "Yes, I'm committed to an agent." },
                { value: "not_committed", text: "No, I'm not committed to an agent." },
                { value: "gathering_info", text: "Just gathering information at this stage." }
              ]
            },
            // Add additional questions if needed (second question will be editable if present)
          ]
        };

        const formContainer = document.getElementById('formContainer');
        const configForm = document.getElementById('configForm');
        const messageDiv = document.getElementById('message');

        function getVal(id) {
            const el = document.getElementById(id);
            return el ? el.value : '';
        }

        function setVal(id, value) {
            const el = document.getElementById(id);
            if (el) {
                el.value = value === undefined || value === null ? '' : value;
            }
        }

        function populateForm() {
            const c = initialConfig;
            // Property
            setVal('streetAddress', c.property.streetAddress);
            setVal('city', c.property.city);
            setVal('cityStateZip', c.property.cityStateZip);
            setVal('heroSubtitle', c.property.heroSubtitle);
            setVal('homeType', c.property.homeType);
            setVal('listingPrice', c.property.listingPrice);
            setVal('beds', c.property.beds);
            setVal('baths', c.property.baths);
            setVal('backgroundImageUrl', c.property.backgroundImageUrl);
            setVal('brandedMediaLink', c.property.brandedMediaLink);
            setVal('listingUrl', c.property.listingUrl);
            setVal('floorplanUrl', c.property.floorplanUrl);
            setVal('comparables', c.property.comparables.join('\n'));
            setVal('virtualTourUrl', c.property.virtualTourUrl);
            setVal('openHouseDate', c.property.openHouseDate);
            setVal('benefits', c.property.benefits.join('\n'));
            setVal('keyFeature', c.property.keyFeature);
            setVal('neighbourhood', c.property.neighbourhood);

            // Realtor
            setVal('realtorFullName', c.realtor.fullName);
            setVal('realtorFirstName', c.realtor.firstName);
            setVal('realtorTitle', c.realtor.title);
            setVal('realtorPhone', c.realtor.phone);
            setVal('realtorEmail', c.realtor.email);
            setVal('realtorBio', c.realtor.bio);
            setVal('realtorPhotoUrl', c.realtor.photoUrl);
            setVal('socialFacebook', c.realtor.social.facebook);
            setVal('socialInstagram', c.realtor.social.instagram);
            setVal('socialWebsite', c.realtor.social.website);

            // Brokerage
            setVal('brokerageName', c.brokerage.name);
            setVal('brokerageLogoUrl', c.brokerage.logoUrl);
            setVal('brokerageAddress', c.brokerage.address);

            // Meta
            setVal('metaPageTitlePrefix', c.meta.pageTitlePrefix);
            setVal('metaNavBrandLogoText', c.meta.navBrandLogoText);
            setVal('metaPrivacyPolicyLink', c.meta.privacyPolicyLink);
            setVal('metaTermsLink', c.meta.termsLink);

            // Settings
            setVal('settingsWebhookUrl', c.settings.webhookUrl);
            setVal('settingsConfettiColors', c.settings.confettiColors.join('\n'));

            // Open House Bundle Items (Max 8)
            const bundleItemsContainer = document.getElementById('bundleItemsContainer');
            bundleItemsContainer.innerHTML = ''; // Clear previous
            for (let i = 0; i < 8; i++) {
                const item = c.openHouse.bundleItems[i] || {};
                const div = document.createElement('div');
                div.className = 'bundle-item';
                div.innerHTML = `
                    <h4>Bundle Item ${i + 1}</h4>
                    <label for="bundleIcon${i}">Icon (e.g., fas fa-star):</label>
                    <input type="text" id="bundleIcon${i}" value="${item.icon || ''}">
                    <label for="bundleText${i}">Text:</label>
                    <input type="text" id="bundleText${i}" value="${item.text || ''}">
                    <label for="bundleLink${i}">Link (optional):</label>
                    <input type="url" id="bundleLink${i}" value="${item.link || ''}">
                `;
                bundleItemsContainer.appendChild(div);
            }

            // Modal Questions (First 2 questions, max 4 options each)
            const modalQuestionsContainer = document.getElementById('modalQuestionsContainer');
            modalQuestionsContainer.innerHTML = ''; // Clear previous
            for (let i = 0; i < 2; i++) { // Max 2 questions
                const question = c.modalQuestions[i];
                if (!question && i === 0 && c.modalQuestions.length > 0) { // Handle if first question exists but second doesn't
                     // This case should not happen if c.modalQuestions[i] is used, but as a safeguard.
                }


                const questionDiv = document.createElement('div');
                questionDiv.className = 'modal-question-group';
                let optionsHTML = '';
                for (let j = 0; j < 4; j++) { // Max 4 options
                    const option = question && question.options[j] ? question.options[j] : {};
                    optionsHTML += `
                        <div class="modal-option-group">
                            <label for="modalQ${i}OptionText${j}">Option ${j + 1} Text:</label>
                            <input type="text" id="modalQ${i}OptionText${j}" value="${option.text || ''}">
                        </div>
                    `;
                }
                questionDiv.innerHTML = `
                    <h4>Modal Question ${i + 1}</h4>
                    <label for="modalQ${i}Text">Question Text:</label>
                    <input type="text" id="modalQ${i}Text" value="${question ? question.questionText : ''}">
                    ${optionsHTML}
                `;
                if (question || i < c.modalQuestions.length) { // Only add if question exists or we are within bounds of original questions
                    modalQuestionsContainer.appendChild(questionDiv);
                } else if (i === 0 && c.modalQuestions.length === 0) { // Add a blank first question if none exist
                     modalQuestionsContainer.appendChild(questionDiv);
                }

            }
        }

        function arrayFromTextarea(id) {
            const val = getVal(id);
            return val.split('\n').map(s => s.trim()).filter(s => s !== '');
        }

        async function handleFormSubmit(event) {
            event.preventDefault();
            messageDiv.textContent = '';
            messageDiv.className = '';

            const updatedConfig = JSON.parse(JSON.stringify(initialConfig)); // Deep clone to preserve structure and original values

            // Property
            updatedConfig.property.streetAddress = getVal('streetAddress');
            updatedConfig.property.city = getVal('city');
            updatedConfig.property.cityStateZip = getVal('cityStateZip');
            updatedConfig.property.heroSubtitle = getVal('heroSubtitle');
            updatedConfig.property.homeType = getVal('homeType');
            updatedConfig.property.listingPrice = getVal('listingPrice');
            updatedConfig.property.beds = getVal('beds');
            updatedConfig.property.baths = getVal('baths');
            updatedConfig.property.backgroundImageUrl = getVal('backgroundImageUrl');
            updatedConfig.property.brandedMediaLink = getVal('brandedMediaLink');
            updatedConfig.property.listingUrl = getVal('listingUrl');
            updatedConfig.property.floorplanUrl = getVal('floorplanUrl');
            updatedConfig.property.comparables = arrayFromTextarea('comparables');
            updatedConfig.property.virtualTourUrl = getVal('virtualTourUrl');
            updatedConfig.property.openHouseDate = getVal('openHouseDate');
            updatedConfig.property.benefits = arrayFromTextarea('benefits');
            updatedConfig.property.keyFeature = getVal('keyFeature');
            updatedConfig.property.neighbourhood = getVal('neighbourhood');

            // Realtor
            updatedConfig.realtor.fullName = getVal('realtorFullName');
            updatedConfig.realtor.firstName = getVal('realtorFirstName');
            updatedConfig.realtor.title = getVal('realtorTitle');
            updatedConfig.realtor.phone = getVal('realtorPhone');
            updatedConfig.realtor.email = getVal('realtorEmail');
            updatedConfig.realtor.bio = getVal('realtorBio');
            updatedConfig.realtor.photoUrl = getVal('realtorPhotoUrl');
            updatedConfig.realtor.social.facebook = getVal('socialFacebook');
            updatedConfig.realtor.social.instagram = getVal('socialInstagram');
            updatedConfig.realtor.social.website = getVal('socialWebsite');

            // Brokerage
            updatedConfig.brokerage.name = getVal('brokerageName');
            updatedConfig.brokerage.logoUrl = getVal('brokerageLogoUrl');
            updatedConfig.brokerage.address = getVal('brokerageAddress');

            // Meta
            updatedConfig.meta.pageTitlePrefix = getVal('metaPageTitlePrefix');
            updatedConfig.meta.navBrandLogoText = getVal('metaNavBrandLogoText');
            updatedConfig.meta.privacyPolicyLink = getVal('metaPrivacyPolicyLink');
            updatedConfig.meta.termsLink = getVal('metaTermsLink');

            // Settings
            // webhookUrl is readonly, confettiColors are collected
            updatedConfig.settings.confettiColors = arrayFromTextarea('settingsConfettiColors');

            // Open House Bundle Items
            updatedConfig.openHouse.bundleItems = [];
            for (let i = 0; i < 8; i++) {
                const icon = getVal(`bundleIcon${i}`);
                const text = getVal(`bundleText${i}`);
                const link = getVal(`bundleLink${i}`);
                if (icon || text || link) { // Only add if at least one field has a value
                    const newItem = { icon, text };
                    if (link) newItem.link = link;
                    // Preserve original comparables if they existed and we are within original item bounds
                    if (initialConfig.openHouse.bundleItems[i] && initialConfig.openHouse.bundleItems[i].comparables) {
                        newItem.comparables = initialConfig.openHouse.bundleItems[i].comparables;
                    }
                    updatedConfig.openHouse.bundleItems.push(newItem);
                }
            }

            // Modal Questions
            for (let i = 0; i < 2; i++) {
                if (updatedConfig.modalQuestions[i]) { // Only update if the question exists in the original config
                    updatedConfig.modalQuestions[i].questionText = getVal(`modalQ${i}Text`);
                    for (let j = 0; j < 4; j++) {
                        if (updatedConfig.modalQuestions[i].options[j]) { // Only update if the option exists
                            updatedConfig.modalQuestions[i].options[j].text = getVal(`modalQ${i}OptionText${j}`);
                        } else if (getVal(`modalQ${i}OptionText${j}`).trim() !== '') { // Add new option if text is provided
                             if (!updatedConfig.modalQuestions[i].options) updatedConfig.modalQuestions[i].options = [];
                             // Create a placeholder value or decide how to handle new option values
                             updatedConfig.modalQuestions[i].options[j] = { value: `new_option_${i}_${j}`, text: getVal(`modalQ${i}OptionText${j}`) };
                        }
                    }
                     // Remove empty options that might have been cleared
                    updatedConfig.modalQuestions[i].options = updatedConfig.modalQuestions[i].options.filter(opt => opt && opt.text && opt.text.trim() !== '');

                } else if (getVal(`modalQ${i}Text`).trim() !== '') { // Potentially add a new question if text is provided for a slot
                    const newQuestion = {
                        id: `new_question_${i}`, // Generate a new ID
                        questionText: getVal(`modalQ${i}Text`),
                        options: []
                    };
                    for (let j = 0; j < 4; j++) {
                        const optionText = getVal(`modalQ${i}OptionText${j}`);
                        if (optionText.trim() !== '') {
                            newQuestion.options.push({ value: `new_option_${i}_${j}`, text: optionText });
                        }
                    }
                    if (newQuestion.options.length > 0) {
                        updatedConfig.modalQuestions.push(newQuestion);
                    }
                }
            }
             // Filter out any completely empty questions that might have resulted from clearing fields
            updatedConfig.modalQuestions = updatedConfig.modalQuestions.filter(q => q && q.questionText && q.questionText.trim() !== '');


            console.log("Submitting updated config:", updatedConfig);

            try {
                const response = await fetch(updatedConfig.settings.webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updatedConfig),
                });

                if (response.ok) {
                    messageDiv.textContent = 'Configuration saved successfully!';
                    messageDiv.className = 'success';
                    // Optionally, re-populate form with potentially modified initialConfig if webhook returns it
                    // For now, we assume the current state is the new "initial"
                    Object.assign(initialConfig, JSON.parse(JSON.stringify(updatedConfig))); // Update in-memory initialConfig
                } else {
                    const errorData = await response.text();
                    messageDiv.textContent = `Error saving configuration: ${response.status} ${errorData}`;
                    messageDiv.className = 'error';
                }
            } catch (error) {
                messageDiv.textContent = `Network error: ${error.message}`;
                messageDiv.className = 'error';
            }
        }


        function init() {
            const password = prompt("Enter password to access admin page:", "");
            if (password === "123456") {
                formContainer.classList.remove('hidden');
                populateForm();
                configForm.addEventListener('submit', handleFormSubmit);
            } else {
                alert("Incorrect password. Access denied.");
                document.body.innerHTML = '<p style="color:red; text-align:center; margin-top: 50px;">Access Denied</p>';
            }
        }

        init();
    </script>
</body>
</html>

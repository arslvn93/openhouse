<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Open House...</title> <!-- Set by JS -->

    <!-- â˜…â˜…â˜… START: SOCIAL SHARE META TAGS - EDIT MANUALLY FOR EACH PAGE â˜…â˜…â˜… -->
    <meta property="og:title" content="ðŸŒŸ Prestige Open House | 789 Diamond Crest Dr | Prestige Property Group" />
    <meta property="og:description" content="Explore this exquisite Beverly Hills estate. Register today to receive the bespoke Property Home &amp; Neighbourhood Info Package..." />
    <meta property="og:image" content="https://via.placeholder.com/220x220/d4af37/101010?text=VA" /> <!-- Match Config -->
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ðŸŒŸ Prestige Open House | 789 Diamond Crest Dr | Prestige Property Group" />
    <meta name="twitter:description" content="Explore this exquisite Beverly Hills estate. Register today to receive the bespoke Property Home &amp; Neighbourhood Info Package..." />
    <meta name="twitter:image" content="https://via.placeholder.com/220x220/d4af37/101010?text=VA" /> <!-- Match Config -->
    <!-- â˜…â˜…â˜… END: SOCIAL SHARE META TAGS â˜…â˜…â˜… -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* --- Root Variables and Base Styles --- */
        :root {
            --primary-color: #e0c58f; --secondary-color: #1b6ca8; --accent-color: #c08497;
            --dark-bg: #0f0f0f; --card-dark-bg: #181818; --light-text-color: #fafafa;
            --medium-text-color: #cccccc; --header-bg: rgba(15, 15, 15, 0.65);
            --header-bg-scrolled: rgba(15, 15, 15, 0.85); --glass-blur: 22px;
            --glass-bg: rgba(28, 28, 28, 0.65); --glass-border: rgba(224, 197, 143, 0.2);
            --glass-shadow: 0 15px 45px 0 rgba(0, 0, 0, 0.4);
            --glass-inner-shadow: inset 0 0 25px rgba(224, 197, 143, 0.06);
            --border-radius: 18px; --transition-speed: 0.6s;
            --cubic-bezier-smooth-out: cubic-bezier(0.165, 0.84, 0.44, 1);
            --font-size-base: clamp(0.875rem, 1.5vw + 0.5rem, 1.05rem);
            --font-size-h1: clamp(2.2rem, 5vw + 1rem, 3.8rem);
            --font-size-h2: clamp(1.8rem, 4vw + 0.8rem, 2.8rem);
            --font-size-h3: clamp(1.4rem, 3vw + 0.6rem, 2rem);
            --font-size-large: clamp(1.1rem, 2vw + 0.5rem, 1.4rem);
            --font-size-medium: clamp(1rem, 1.8vw + 0.4rem, 1.2rem);
            --font-size-small: clamp(0.85rem, 1.2vw + 0.4rem, 1rem);
            /* Corrected minimum input font size for clamp */
             --font-size-input: clamp(1rem, 1.8vw + 0.4rem, 1.05rem); /* Min 1rem (16px) */
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: var(--font-size-base); }
        body { font-family: 'Poppins', sans-serif; font-weight: 400; line-height: 1.8; color: var(--light-text-color); background-color: var(--dark-bg); background-image: linear-gradient(rgba(15, 15, 15, 0.7), rgba(15, 15, 15, 0.85)), var(--bg-image-url, url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80')); background-attachment: fixed; background-position: center; background-repeat: no-repeat; background-size: cover; overflow-x: hidden; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .container { max-width: 1100px; margin: auto; padding: 0 clamp(15px, 5vw, 30px); }
        .section { padding: clamp(60px, 10vh, 100px) 0; opacity: 0; transform: translateY(60px); transition: opacity 1.3s var(--cubic-bezier-smooth-out), transform 1.3s var(--cubic-bezier-smooth-out); }
        .section.visible { opacity: 1; transform: translateY(0); }
        .section-title { font-family: 'Playfair Display', serif; font-size: var(--font-size-h2); font-weight: 700; color: var(--primary-color); text-align: center; margin-bottom: clamp(40px, 8vh, 70px); position: relative; padding-bottom: 20px; letter-spacing: 1.5px; }
        .section-title::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: clamp(80px, 15vw, 120px); height: 2px; background: linear-gradient(90deg, transparent, var(--primary-color), transparent); opacity: 0.8; }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur)); border-radius: var(--border-radius); border: 1px solid var(--glass-border); box-shadow: var(--glass-shadow), var(--glass-inner-shadow); padding: clamp(30px, 6vw, 50px) clamp(30px, 7vw, 60px); margin-top: clamp(30px, 5vh, 50px); color: var(--light-text-color); position: relative; overflow: hidden; background-image: linear-gradient(160deg, rgba(28, 28, 28, 0.6) 0%, rgba(35, 35, 35, 0.7) 100%), var(--glass-bg); transition: background 0.8s ease-out; }
        .section.visible .glass-card { background-image: none; }
        .main-nav { position: fixed; top: 0; left: 0; width: 100%; background: var(--header-bg); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); padding: 18px 0; z-index: 1000; border-bottom: 1px solid rgba(224, 197, 143, 0.1); transition: background-color 0.4s ease, padding 0.4s ease, top 0.4s ease; }
        .main-nav.scrolled { background: var(--header-bg-scrolled); padding: 14px 0; }
        .main-nav .container { display: flex; justify-content: space-between; align-items: center; }
        .header-left { display: flex; align-items: center; gap: clamp(15px, 3vw, 25px); }
        .main-nav .logo { font-family: 'Montserrat', sans-serif; color: var(--light-text-color); font-size: clamp(1.4rem, 3vw, 1.7rem); font-weight: 600; text-decoration: none; }
        .header-address { font-size: var(--font-size-small); color: var(--medium-text-color); font-weight: 300; border-left: 1px solid var(--glass-border); padding-left: clamp(15px, 3vw, 20px); opacity: 0.8; transition: opacity 0.4s ease; display: none; }
        @media (min-width: 768px) { .header-address { display: block; } }
        .main-nav ul { list-style: none; display: none; padding: 0; margin: 0; }
        @media (min-width: 992px) { .main-nav ul { display: flex; } .main-nav ul li { margin-left: clamp(25px, 4vw, 40px); } .main-nav ul li a { color: var(--medium-text-color); text-decoration: none; font-weight: 500; padding: 10px 0; font-size: var(--font-size-small); letter-spacing: 0.8px; position: relative; transition: color var(--transition-speed) var(--cubic-bezier-smooth-out); } .main-nav ul li a::after { content: ''; position: absolute; bottom: -3px; left: 0; width: 0; height: 1.5px; background-color: var(--primary-color); transition: width 0.4s var(--cubic-bezier-smooth-out); } .main-nav ul li a:hover { color: var(--light-text-color); } .main-nav ul li a:hover::after { width: 100%; } .main-nav ul li a.active { color: var(--primary-color); font-weight: 600; } .main-nav ul li a.active::after { width: 100%; } }
        @media (max-width: 991px) { .main-nav .container { justify-content: center; } .header-left { gap: 15px; } }
        @media (max-width: 600px) { .header-address { display: none;} .main-nav .logo { font-size: clamp(1.3rem, 5vw, 1.5rem); } .main-nav { padding: 15px 0; } .main-nav.scrolled { padding: 12px 0; } }
        #hero { min-height: 100vh; min-height: 100svh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: var(--light-text-color); padding: 100px 15px 60px; position: relative; overflow: hidden; }
        #hero > * { position: relative; }
        #hero .hero-title-line { font-family: 'Playfair Display', serif; font-size: var(--font-size-h1); font-weight: 700; margin-bottom: clamp(15px, 4vh, 30px); color: #fff; line-height: 1.2; display: inline-block; min-height: 1.2em; text-shadow: 1px 1px 30px rgba(0, 0, 0, 0.7); }
        #hero .hero-title-line .highlight { color: var(--primary-color); }
        #hero .hero-title-line:not(.typing-done)::after { content: ''; display: inline-block; width: 3px; height: 0.9em; background-color: var(--primary-color); margin-left: 8px; vertical-align: baseline; opacity: 1; animation: blink 0.8s step-end infinite; }
        #hero .hero-title-line.typing-done::after { display: none; }
        #hero p.subtitle { font-size: var(--font-size-large); margin-bottom: clamp(35px, 6vh, 55px); max-width: 850px; font-weight: 300; color: var(--medium-text-color); line-height: 1.9; opacity: 0.01; transform: translateY(15px) scale(0.98); transition: opacity 1s ease-out 0.2s, transform 1s ease-out 0.2s; }
        .cta-button { font-size: var(--font-size-medium); padding: clamp(16px, 2.5vw, 20px) clamp(35px, 6vw, 50px); display: inline-block; background: linear-gradient(135deg, var(--primary-color), #b89b59); color: var(--dark-bg); font-weight: 600; text-decoration: none; border-radius: 50px; letter-spacing: 1px; transition: all var(--transition-speed) var(--cubic-bezier-smooth-out); box-shadow: 0 8px 35px rgba(224, 197, 143, 0.25); position: relative; overflow: hidden; opacity: 0.01; transform: translateY(15px) scale(0.98); transition: opacity 1s ease-out 0.4s, transform 1s ease-out 0.4s, background 0.4s, box-shadow 0.4s; }
        #hero.typing-complete p.subtitle { transition-delay: 0.3s; }
        #hero.typing-complete .cta-button { transition-delay: 0.5s; }
        #hero.typing-complete p.subtitle, #hero.typing-complete .cta-button { opacity: 1; transform: translateY(0) scale(1); }
        .cta-button::before { content: ''; position: absolute; top: 0; left: -110%; width: 60%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.35), transparent); transform: skewX(-25deg); transition: left 0.8s ease; }
        .cta-button:hover::before { left: 130%; }
        .cta-button:hover { background: linear-gradient(135deg, #b89b59, var(--primary-color)); transform: scale(1.05) translateY(-4px); box-shadow: 0 12px 45px rgba(224, 197, 143, 0.35); }
        .cta-button i { margin-left: 15px; }
        @keyframes blink { 50% { opacity: 0; } }
        #whats-included ul { list-style: none; padding: 0; margin: 20px auto; max-width: 750px; }
        #whats-included li { background: rgba(255, 255, 255, 0.02); margin-bottom: 22px; padding: clamp(18px, 3vw, 24px) clamp(20px, 4vw, 30px); border-radius: 14px; display: flex; align-items: center; transition: transform 0.5s var(--cubic-bezier-smooth-out), background-color 0.5s var(--cubic-bezier-smooth-out), box-shadow 0.5s var(--cubic-bezier-smooth-out); border: 1px solid rgba(224, 197, 143, 0.12); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        #whats-included li:hover { transform: scale(1.03) translateX(8px); background-color: rgba(224, 197, 143, 0.08); box-shadow: 0 8px 25px rgba(0,0,0,0.25); }
        #whats-included li i { font-size: clamp(1.6rem, 3vw, 2rem); color: var(--secondary-color); margin-right: clamp(20px, 4vw, 30px); width: 40px; text-align: center; transition: transform 0.5s var(--cubic-bezier-smooth-out); }
        #whats-included li:hover i { transform: scale(1.15) rotate(4deg); }
        #whats-included li span { font-size: var(--font-size-medium); font-weight: 400; color: var(--light-text-color); }
        #about-realtor .realtor-content { display: flex; flex-direction: column; align-items: center; gap: 30px; text-align: center;}
        @media (min-width: 768px) { #about-realtor .realtor-content { flex-direction: row; text-align: left; gap: clamp(40px, 6vw, 60px); } }
        #about-realtor .realtor-image-container { flex-shrink: 0; width: clamp(150px, 30vw, 200px); height: clamp(150px, 30vw, 200px); position: relative; border-radius: 50%; box-shadow: 0 0 45px rgba(224, 197, 143, 0.3); margin-bottom: 15px; }
        @media (min-width: 768px) { #about-realtor .realtor-image-container { margin-bottom: 0; } }
        #about-realtor .realtor-image-container img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; border: clamp(5px, 1vw, 7px) solid var(--primary-color); display: block; }
        #about-realtor .realtor-bio { flex-grow: 1; }
        #about-realtor .realtor-bio h3 { font-family: 'Montserrat', sans-serif; font-size: var(--font-size-h3); color: var(--primary-color); margin-bottom: 18px; font-weight: 600; }
        #about-realtor .realtor-bio p { font-size: var(--font-size-small); line-height: 1.9; color: var(--medium-text-color); font-weight: 300; }
        #signin p.subtitle { color: var(--medium-text-color); text-align: center; margin-top: calc(-1 * clamp(25px, 5vh, 40px)); margin-bottom: clamp(35px, 6vh, 50px); font-size: var(--font-size-medium); font-weight: 300; }
        #signin .form-grid { display: grid; grid-template-columns: 1fr; gap: clamp(25px, 4vh, 35px); margin-top: 35px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .form-group label { display: block; margin-bottom: 12px; font-weight: 500; color: var(--medium-text-color); font-size: var(--font-size-small); letter-spacing: 0.7px; }

        /* --- â˜…â˜…â˜… CSS FIX FOR INPUT FONT SIZE â˜…â˜…â˜… --- */
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"] {
            width: 100%;
            padding: clamp(15px, 2.2vw, 18px) 25px; /* Responsive Padding */
            padding-left: clamp(50px, 8vw, 60px); /* Space for icon */
            border: 1px solid rgba(224, 197, 143, 0.2);
            border-radius: 14px;
             /* Ensure font size is at least 16px (1rem) to prevent iOS zoom */
             font-size: var(--font-size-input); /* Use variable set to clamp(1rem,...) */
            font-family: 'Poppins', sans-serif;
            background-color: rgba(22, 22, 22, 0.75);
            color: var(--light-text-color);
            transition: all 0.4s var(--cubic-bezier-smooth-out);
            min-height: 50px; /* Good tap height */
        }
        /* --- End Input Font Size Fix --- */

        .form-group input::placeholder { color: var(--medium-text-color); opacity: 0.4; }
        .form-group input:focus { outline: none; border-color: var(--primary-color); background-color: rgba(30, 30, 30, 0.85); box-shadow: 0 0 22px rgba(224, 197, 143, 0.2); }
        .input-wrapper { position: relative; }
        .input-wrapper i { position: absolute; left: clamp(18px, 3vw, 22px); top: 50%; transform: translateY(-50%); color: var(--medium-text-color); font-size: clamp(1rem, 2vw, 1.15rem); transition: color 0.4s var(--cubic-bezier-smooth-out); pointer-events: none; }
        .input-wrapper input:focus + i { color: var(--primary-color); }
        .submit-btn { background: linear-gradient(135deg, var(--primary-color), #b89b59); color: var(--dark-bg); border: none; padding: clamp(16px, 2.5vw, 18px) 40px; font-size: var(--font-size-medium); font-weight: 600; border-radius: 50px; cursor: pointer; transition: all var(--transition-speed) var(--cubic-bezier-smooth-out); width: 100%; margin-top: 20px; letter-spacing: 1px; box-shadow: 0 7px 30px rgba(224, 197, 143, 0.2); display: flex; align-items: center; justify-content: center; gap: 15px; position: relative; overflow: hidden; min-height: 55px; }
        .submit-btn:hover { background: linear-gradient(135deg, #b89b59, var(--primary-color)); transform: translateY(-5px) scale(1.03); box-shadow: 0 12px 40px rgba(224, 197, 143, 0.3); }
        .submit-btn:active { transform: translateY(-2px) scale(1.01); box-shadow: 0 7px 30px rgba(224, 197, 143, 0.25); }
        .submit-btn i { font-size: clamp(1.1rem, 2vw, 1.25rem); }
        .submit-btn.loading { background: var(--medium-text-color); cursor: not-allowed; color: rgba(15,15,15, 0.7); }
        .submit-btn .button-text { transition: opacity 0.3s ease; }
        .submit-btn.loading .button-text { opacity: 0; }
        .submit-btn .spinner { display: inline-block; position: absolute; width: 20px; height: 20px; border: 3px solid rgba(15, 15, 15, 0.3); border-radius: 50%; border-top-color: var(--dark-bg); animation: spin 1s ease-in-out infinite; opacity: 0; transition: opacity 0.3s ease; }
        .submit-btn.loading .spinner { opacity: 1; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Modal Styles (Simplified visibility focus) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(15, 15, 15, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 1050; opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0s linear 0.4s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; transition-delay: 0s; }
        .modal-content { background: var(--card-dark-bg); padding: clamp(30px, 5vw, 40px); border-radius: var(--border-radius); box-shadow: 0 10px 50px rgba(0,0,0,0.5), 0 0 0 1px rgba(224, 197, 143, 0.15); text-align: center; max-width: 550px; width: 90%; position: relative; transform: translateY(0); opacity: 1; /* Basic display */ transition: none; }
        .modal-step { display: none; opacity: 1; }
        .modal-step.active { display: block !important; opacity: 1 !important; animation: fadeInStep 0.4s ease-out forwards; }
        @keyframes fadeInStep { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .modal-step .question-text { font-size: var(--font-size-large); font-weight: 500; color: var(--light-text-color); margin-bottom: 35px; line-height: 1.6; }
        .modal-options { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .modal-option-btn { display: block; width: 100%; max-width: 380px; padding: 15px 25px; font-size: var(--font-size-medium); font-weight: 500; color: var(--light-text-color); background-color: rgba(255, 255, 255, 0.08); border: 1px solid var(--glass-border); border-radius: 12px; cursor: pointer; text-align: center; transition: background-color 0.3s ease, transform 0.2s ease, border-color 0.3s ease; }
        .modal-option-btn:hover { background-color: rgba(224, 197, 143, 0.15); border-color: rgba(224, 197, 143, 0.3); transform: translateY(-2px); }
        .modal-option-btn:active { transform: translateY(0); background-color: rgba(224, 197, 143, 0.2); }
        #modal-step-final i.icon { font-size: clamp(4rem, 10vw, 5rem); color: var(--primary-color); margin-bottom: 25px; display: inline-block; text-shadow: 0 0 20px rgba(224, 197, 143, 0.4); }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 80% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1;} }
        #modal-step-final i.icon { animation: popIn 0.6s var(--cubic-bezier-smooth-out) 0.3s backwards; }
        #modal-step-final h2 { font-family: 'Playfair Display', serif; font-size: var(--font-size-h3); color: var(--primary-color); margin-bottom: 15px; font-weight: 700; }
        #modal-step-final p#modalMainMessage { font-size: var(--font-size-medium); margin-bottom: 30px; line-height: 1.8; color: var(--medium-text-color); font-weight: 300;}
        #modal-step-final p#modalHost { font-size: var(--font-size-small); color: var(--medium-text-color); }
        #modal-step-final strong { color: var(--light-text-color); font-weight: 500; }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.8rem; color: var(--medium-text-color); cursor: pointer; padding: 5px; line-height: 1; transition: color 0.3s ease, transform 0.3s ease; z-index: 2; }
        .modal-close-btn:hover { color: var(--light-text-color); transform: rotate(90deg); }
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1060; pointer-events: none; }
        @keyframes bounce { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-15px) scale(1.03); } }

         /* Footer Styles (Restored) */
        footer { background-color: #0a0a0a; color: var(--medium-text-color); text-align: center; padding: clamp(50px, 8vh, 80px) clamp(15px, 5vw, 30px) clamp(30px, 5vh, 50px); margin-top: clamp(60px, 10vh, 100px); border-top: 1px solid rgba(224, 197, 143, 0.15); }
        footer .footer-content { max-width: 850px; margin: auto; }
        footer .brokerage-logo img { max-height: clamp(45px, 8vw, 60px); margin-bottom: 30px; }
        footer h4 { font-family: 'Montserrat', sans-serif; font-size: var(--font-size-large); font-weight: 500; margin-bottom: 25px; color: var(--primary-color); letter-spacing: 1.2px; }
        footer p { margin-bottom: 15px; font-size: var(--font-size-small); line-height: 1.8; font-weight: 300;}
        footer strong { color: var(--light-text-color); font-weight: 500; }
        footer a { color: var(--primary-color); text-decoration: none; transition: color 0.4s ease; }
        footer a:hover { color: #fff2d8; }
        footer p i { margin-right: 8px; opacity: 0.8; }
        footer p i.fa-envelope { margin-left: 15px; }
        footer .social-icons { margin: clamp(25px, 5vh, 40px) 0; }
        footer .social-icons a { color: var(--medium-text-color); font-size: clamp(1.4rem, 3vw, 1.7rem); margin: 0 clamp(12px, 2.5vw, 18px); transition: color 0.4s var(--cubic-bezier-smooth-out), transform 0.4s var(--cubic-bezier-smooth-out); }
        footer .social-icons a:hover { color: var(--primary-color); transform: scale(1.2) rotate(-5deg); }
        footer .copyright { margin-top: clamp(30px, 6vh, 50px); font-size: clamp(0.75rem, 1.5vw + 0.3rem, 0.9rem); opacity: 0.6; font-weight: 300;}
        footer .copyright a { color: var(--primary-color); opacity: 0.8; }
        footer .copyright a:hover { color: #fff2d8; opacity: 1; }

        @media (max-width: 767px) { /* Target typical mobile device widths */
            #signInForm input[type="text"],
            #signInForm input[type="email"],
            #signInForm input[type="tel"] {
                font-size: 16px !important; /* Force 16px font size on mobile */
            }
        }

    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    <nav class="main-nav" id="mainNav">
        <div class="container">
             <div class="header-left">
                <a href="#" class="logo" id="navBrandLogo"></a>
                <span class="header-address" id="navAddress"></span>
             </div>
             <ul id="navLinksList">
                <li><a href="#hero" class="active">Welcome</a></li>
                <li><a href="#whats-included"> Home Package</a></li>
                <li><a href="#about-realtor">Your Host</a></li>
                <li><a href="#signin">Register</a></li>
             </ul>
        </div>
    </nav>

    <section id="hero" class="section visible">
        <div class="hero-title-line" id="heroTitle"></div>
        <p class="subtitle" id="heroSubtitle"></p>
        <a href="#signin" class="cta-button" id="heroCta">Register & Receive Home &amp; Neighbourhood Info Package <i class="fas fa-chevron-right"></i></a>
    </section>

    <main>
        <section id="whats-included" class="section"> <div class="container"> <div class="glass-card"> <h2 class="section-title">The Property Home &amp; Neighbourhood Info Package</h2> <ul id="bundleList"></ul> </div> </div> </section>
        <section id="about-realtor" class="section"> <div class="container"> <div class="glass-card"> <h2 class="section-title">Your Dedicated Host</h2> <div class="realtor-content"> <div class="realtor-image-container"> <img src="" alt="Realtor Photo" id="realtorPhoto"> </div> <div class="realtor-bio"> <h3 id="realtorNameBio"></h3> <p id="realtorBioText"></p> </div> </div> </div> </div> </section>
        <section id="signin" class="section">
            <div class="container">
                 <div class="glass-card" id="signInCard">
                     <h2 class="section-title">Register Your Interest</h2>
                     <p class="subtitle">Kindly provide your details...</p>
                     <form id="signInForm">
                         <div class="form-grid">
                            <div class="form-group"><label for="fullName">Full Name:</label><div class="input-wrapper"><input type="text" id="fullName" name="fullName" placeholder="Example Full Name" required><i class="fas fa-user-tie"></i></div></div>
                            <div class="form-group"><label for="email">Email Address:</label><div class="input-wrapper"><input type="email" id="email" name="email" placeholder="Example Email" required><i class="fas fa-envelope-open-text"></i></div></div>
                            <div class="form-group">
                                <label for="phone">Phone Number (Preferred):</label>
                                <div class="input-wrapper">
                                    <input type="tel" id="phone" name="phone" placeholder="Example Phone"
                                           inputmode="numeric"> <!-- â˜…â˜…â˜… INPUTMODE ADDED HERE â˜…â˜…â˜… -->
                                    <i class="fas fa-phone-volume"></i>
                                </div>
                            </div>
                        <div class="form-group" style="grid-column: 1 / -1; text-align: left;">
                            <div style="display: flex; align-items: flex-start; gap: 10px; padding: 10px; border: 1px solid var(--glass-border); border-radius: 8px; background-color: rgba(255,255,255,0.03);">
                                <input type="checkbox" id="consentCheckbox" name="consent" required style="margin-top: 5px; width: auto; min-height: auto; flex-shrink: 0; accent-color: var(--primary-color);">
                                <label for="consentCheckbox" style="font-size: clamp(0.75rem, 1.8vw + 0.3rem, 0.9rem); color: var(--medium-text-color); font-weight: 300; line-height: 1.6;">
                                    I agree to be contacted by <strong id="consentBrokerageName" style="color: var(--light-text-color);">[Brokerage Name]</strong> via call, email, and text. To opt-out, you can reply â€˜stopâ€™ at any time or click the unsubscribe link in the emails. Message and data rates may apply. <a href="#" id="consentPrivacyLink" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">Privacy Policy</a>
                                </label>
                            </div>
                        </div>
                            <div class="form-group"><button type="submit" class="submit-btn"><span class="button-text">Request My Home &amp; Neighbourhood Info Package</span><div class="spinner"></div></button></div>
                         </div>
                     </form>
                 </div>
             </div>
        </section>
    </main>

    <footer> <!-- Footer HTML Structure -->
        <div class="container footer-content">
             <div class="brokerage-logo"> <img src="" alt="Brokerage Logo" id="footerBrokerageLogo"> </div>
            <h4 id="footerBrokerageName"></h4>
            <p><strong id="footerRealtorName"></strong> | <span id="footerRealtorTitle"></span></p>
            <p><i class="fas fa-mobile-alt" style="margin-right: 8px;"></i> <a href="" id="footerRealtorPhoneLink"><span id="footerRealtorPhone"></span></a> | <i class="fas fa-envelope" style="margin-left: 15px; margin-right: 8px;"></i> <a href="" id="footerRealtorEmailLink"><span id="footerRealtorEmail"></span></a></p>
            <p><i class="fas fa-map-pin" style="margin-right: 8px;"></i> <span id="footerBrokerageAddress"></span></p>
             <div class="social-icons" id="footerSocialIcons"></div>
            <p class="copyright" id="footerCopyright"></p>
        </div>
    </footer>

    <div class="modal-overlay" id="successModalOverlay">
        <div class="modal-content" id="successModalContent" role="dialog" aria-modal="true" aria-labelledby="modalStepTitle">
            <button class="modal-close-btn" id="modalCloseBtn" aria-label="Close"><i class="fas fa-times" aria-hidden="true"></i></button>
            <div id="modal-steps-container"><!-- Dynamic Step Content Goes Here --></div>
             <div class="modal-step" id="modal-step-final" style="display: none;"> <!-- Starts hidden -->
                 <i class="fas fa-check-circle icon"></i>
                 <h2 id="modalHeader">Thank You!</h2>
                 <p id="modalMainMessage">Info Sent For <strong id="modalAddress"></strong> Open House Bundle.<br><br><span id="modalEmailPrompt">You will receive an email...</span></p>
                 <p id="modalHost">Your Host: <strong id="modalRealtorName"></strong></p>
             </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Load config first -->
    <script src="config.js"></script>
    <script>
        // Config object is now loaded from config.js
        document.addEventListener('DOMContentLoaded', () => {
            // Check if config object loaded correctly
            if (typeof config === 'undefined') {
                 console.error("FATAL: Configuration file (config.js) failed to load. Cannot initialize page.");
                 // Optionally display an error message to the user on the page itself
                 document.body.innerHTML = '<p style="color:red; text-align:center; margin-top: 50px; font-size:18px; width:100%;">Configuration Error: config.js not found or invalid.</p>';
                 return; // Stop execution if config is missing
            }

            // --- DOM References ---
            const mainNav = document.getElementById('mainNav');
            const heroSection = document.getElementById('hero');
            const heroTitleElement = document.getElementById('heroTitle');
            const heroSubtitle = document.getElementById('heroSubtitle');
            const signInForm = document.getElementById('signInForm');
            const successModalOverlay = document.getElementById('successModalOverlay');
            const successModalContent = document.getElementById('successModalContent');
            const modalStepsContainer = document.getElementById('modal-steps-container');
            const modalStepFinal = document.getElementById('modal-step-final');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const confettiCanvas = document.getElementById('confetti-canvas');
            const myConfetti = (typeof confetti === 'function' && confettiCanvas) ? confetti.create(confettiCanvas, { resize: true, useWorker: true }) : null;
            const submitButton = signInForm?.querySelector('.submit-btn');
            const buttonTextSpan = submitButton?.querySelector('.button-text'); // Ensure this exists if using

            // --- State Variables ---
            let currentStepIndex = 0;
            let collectedAnswers = {};
            let storedInitialPayload = null; // Stores the entire initial payload for the second submission

            // --- Helper functions ---
             function setTextContent(id, text) { const el=document.getElementById(id); if(el) el.textContent=text||''; else console.warn(`ID '${id}' not found.`); }
             function setHTMLContent(id, html) { const el=document.getElementById(id); if(el) el.innerHTML=html||''; else console.warn(`ID '${id}' not found.`); }
             function setImage(id, src, alt) { const el=document.getElementById(id); if(el && el.tagName==='IMG'){ el.src=src||''; el.alt=alt||'Image'; } else console.warn(`ID '${id}' not IMG or not found.`); }
             function setLinkHref(id, href) { const el=document.getElementById(id); if(el && el.tagName==='A'){ el.href=href||'#'; } else console.warn(`ID '${id}' not A or not found.`); }
             function populateSocialIcons(containerId, socialLinks) { const container = document.getElementById(containerId); if (!container) { console.warn(`Social container '${containerId}' not found.`); return; } container.innerHTML = ''; const platformIcons = { linkedin: 'fab fa-linkedin-in', instagram: 'fab fa-instagram', website: 'fas fa-globe', facebook: 'fab fa-facebook-f', twitter: 'fab fa-twitter'}; for (const platform in socialLinks) { const url = socialLinks[platform]; if (url && url !== "#" && url !== "") { const iconClass = platformIcons[platform]; if (iconClass) { const link = document.createElement('a'); link.href = url; link.target = "_blank"; link.rel = "noopener noreferrer"; link.setAttribute('aria-label', platform.charAt(0).toUpperCase() + platform.slice(1)); link.innerHTML = `<i class="${iconClass}" aria-hidden="true"></i>`; container.appendChild(link); } } } }

            // --- Apply Initial Config Data Function ---
            function populateInitialData() {
                try {
                    if (config.property.backgroundImageUrl && config.property.backgroundImageUrl !== "[BACKGROUND_IMAGE_URL_HERE]") { document.body.style.setProperty('--bg-image-url', `url('${config.property.backgroundImageUrl}')`); }
                    document.title = `${config.meta.pageTitlePrefix} | ${config.property.streetAddress} | ${config.brokerage.name}`;
                    setTextContent('navBrandLogo', config.meta.navBrandLogoText || config.brokerage.name);
                    setTextContent('navAddress', config.property.streetAddress);
                    setTextContent('heroSubtitle', config.property.heroSubtitle);
                    const bundleList = document.getElementById('bundleList');
                    if (bundleList) { bundleList.innerHTML = ''; config.openHouse.bundleItems.forEach(item => { const li = document.createElement('li'); li.innerHTML = `<i class="${item.icon}" aria-hidden="true"></i> <span>${item.text}</span>`; bundleList.appendChild(li); }); } else { console.warn("Bundle list element not found."); }
                    setImage('realtorPhoto', config.realtor.photoUrl, config.realtor.fullName);
                    setTextContent('realtorNameBio', config.realtor.fullName);
                    setHTMLContent('realtorBioText', config.realtor.bio);
                    setTextContent('modalAddress', `${config.property.streetAddress}, ${config.property.city}`);
                    setTextContent('modalRealtorName', config.realtor.fullName);

                    // Populate consent checkbox details
                    const consentBrokerageNameEl = document.getElementById('consentBrokerageName');
                    if (consentBrokerageNameEl) {
                        consentBrokerageNameEl.textContent = config.brokerage.name || 'Your Company';
                    }
                    const consentPrivacyLinkEl = document.getElementById('consentPrivacyLink');
                    if (consentPrivacyLinkEl) {
                        consentPrivacyLinkEl.href = config.meta.privacyPolicyLink || '#';
                    }

                    // **** FOOTER POPULATION RESTORED ****
                    setImage('footerBrokerageLogo', config.brokerage.logoUrl, config.brokerage.name);
                    setTextContent('footerBrokerageName', `${config.brokerage.name}`);
                    setTextContent('footerRealtorName', config.realtor.fullName);
                    setTextContent('footerRealtorTitle', config.realtor.title);
                    // setTextContent('footerRealtorDre', config.realtor.dreNumber); // DRE number removed
                    setTextContent('footerRealtorPhone', config.realtor.phone);
                    setLinkHref('footerRealtorPhoneLink', `tel:${config.realtor.phone.replace(/\D/g,'')}`);
                    setTextContent('footerRealtorEmail', config.realtor.email);
                    setLinkHref('footerRealtorEmailLink', `mailto:${config.realtor.email}`);
                    setTextContent('footerBrokerageAddress', config.brokerage.address);
                    const currentYear = new Date().getFullYear();
                    setHTMLContent('footerCopyright', `Â© ${currentYear} ${config.brokerage.name}. All Rights Reserved. Licensed Real Estate Brokerage. Equal Housing Opportunity. | <a href="${config.meta.privacyPolicyLink || '#'}">Privacy Policy</a>`); // Terms link removed
                    populateSocialIcons('footerSocialIcons', config.realtor.social);
                     // **** END FOOTER POPULATION ****
                } catch (error) { console.error("Error populating data:", error); }
            }
            populateInitialData();

             // --- General Page Logic ---
             let lastScrollTop = 0; const handleScroll = () => { let scrollTop = window.pageYOffset || document.documentElement.scrollTop; if (mainNav) { if (scrollTop > 50) { mainNav.classList.add('scrolled'); } else { mainNav.classList.remove('scrolled'); } } setActiveLink(); }; window.addEventListener('scroll', handleScroll, { passive: true });
             const handleHeroParallax = () => { const scrollY = window.pageYOffset; const parallaxFactor = 0.1; if (heroSection) { const title = heroSection.querySelector('#heroTitle'); const subtitle = heroSection.querySelector('#heroSubtitle'); const cta = heroSection.querySelector('#heroCta'); if(title) title.style.transform = `translateY(${scrollY * parallaxFactor * 0.5}px)`; if(subtitle) subtitle.style.transform = `translateY(${scrollY * parallaxFactor}px)`; if(cta) cta.style.transform = `translateY(${scrollY * parallaxFactor * 1.1}px)`; } }; if (window.innerWidth > 992) { window.addEventListener('scroll', handleHeroParallax, { passive: true }); }
             const navLinks = document.querySelectorAll('#navLinksList li a'); const sectionsForNav = document.querySelectorAll('section[id]'); const setActiveLink = () => { let currentSectionId = 'hero'; const navHeight = mainNav ? mainNav.offsetHeight : 70; const scrollPosition = window.pageYOffset; sectionsForNav.forEach(section => { const sectionTop = section.offsetTop - navHeight - window.innerHeight * 0.3; const sectionBottom = sectionTop + section.offsetHeight; if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) { currentSectionId = section.getAttribute('id'); } }); const nearBottom = (window.innerHeight + scrollPosition) >= document.body.offsetHeight - 200; if (nearBottom && document.getElementById('signin')) { currentSectionId = 'signin'; } if (navLinks) { navLinks.forEach(link => { link.classList.remove('active'); const linkHref = link.getAttribute('href'); if (linkHref === `#${currentSectionId}`) { link.classList.add('active'); } }); } }; setActiveLink();
             const titleHTML = `Welcome to <span class="highlight">${config.property.streetAddress}'s</span> Open House`; let titleCharIndex = 0; function typeWriter() { if (!heroTitleElement) return; if (titleCharIndex < titleHTML.length) { let currentHTML = heroTitleElement.innerHTML; if (titleHTML.charAt(titleCharIndex) === '<') { const tagEndIndex = titleHTML.indexOf('>', titleCharIndex); if (tagEndIndex !== -1) { currentHTML += titleHTML.substring(titleCharIndex, tagEndIndex + 1); heroTitleElement.innerHTML = currentHTML; titleCharIndex = tagEndIndex + 1; } else { currentHTML += titleHTML.charAt(titleCharIndex); heroTitleElement.innerHTML = currentHTML; titleCharIndex++; } } else { currentHTML += titleHTML.charAt(titleCharIndex); heroTitleElement.innerHTML = currentHTML; titleCharIndex++; } const speed = titleHTML.charAt(titleCharIndex - 1) === '>' ? 5 : 45 + Math.random() * 35; setTimeout(typeWriter, speed); } else { heroTitleElement.classList.add('typing-done'); heroSection.classList.add('typing-complete'); } } if(heroTitleElement) setTimeout(typeWriter, 500);
             const sections = document.querySelectorAll('.section:not(#hero)'); const observerOptions = { root: null, threshold: 0.15, rootMargin: "0px 0px -10% 0px" }; const observer = new IntersectionObserver((entries, observer) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); /* observer.unobserve(entry.target); */ } }); }, observerOptions); sections.forEach(section => { observer.observe(section); });

            // --- Confetti Function ---
             function fireCoolConfetti() { if (!myConfetti) { console.warn("Confetti library not loaded."); return; } const defaults = { startVelocity: 35, spread: 360, ticks: 80, zIndex: 1060, particleCount: 120, }; const colors = config.settings.confettiColors || ['#e0c58f', '#ffffff', '#1b6ca8']; myConfetti({ ...defaults, particleCount: 80, angle: 60, spread: 70, origin: { x: 0.1, y: 0.7 }, colors: colors, scalar: 1.1 }); myConfetti({ ...defaults, particleCount: 80, angle: 120, spread: 70, origin: { x: 0.9, y: 0.7 }, colors: colors, scalar: 1.1 }); myConfetti({ ...defaults, particleCount: 150, spread: 100, origin: { y: 0.5 }, colors: colors, scalar: 1.2 }); myConfetti({ ...defaults, particleCount: 30, shapes: ['star'], colors: ['#FFD700', '#FFEA00'], scalar: 0.75, origin: { y: 0.6 } }); }


            // --- Modal Step Display & Handling (Simplified CSS Focus) ---
            async function displayModalStep(stepIndex) { // Made async
                console.log(`Displaying step index: ${stepIndex}`);
                if (!successModalContent || !modalStepsContainer || !modalStepFinal) { console.error("Modal structure elements missing!"); if (submitButton) { submitButton.disabled = false; submitButton.classList.remove('loading'); } return; }
                if (!successModalOverlay) { console.error("Modal overlay missing!"); return; }

                // Ensure overlay is visible
                if (!successModalOverlay.classList.contains('visible')) { console.warn("Overlay wasn't visible when trying to display step. Forcing visible."); successModalOverlay.classList.add('visible'); }

                modalStepsContainer.innerHTML = '';
                modalStepFinal.style.display = 'none';
                modalStepFinal.classList.remove('active');

                try {
                    if (stepIndex >= 0 && stepIndex < config.modalQuestions.length) {
                        const questionData = config.modalQuestions[stepIndex];
                        console.log("Creating question step:", questionData.id);
                        const stepDiv = document.createElement('div');
                        stepDiv.classList.add('modal-step');
                        stepDiv.id = `modal-step-${questionData.id}`;
                        stepDiv.innerHTML = `
                            <p class="question-text" id="modalStepTitle-${questionData.id}">${questionData.questionText}</p>
                            <div class="modal-options">
                                ${questionData.options.map(option => `
                                    <button type="button" class="modal-option-btn"
                                            data-step="${stepIndex}" data-question-id="${questionData.id}" data-answer="${option.value}">
                                        ${option.text}
                                    </button>
                                `).join('')}
                            </div>`;
                        stepDiv.querySelectorAll('.modal-option-btn').forEach(button => button.addEventListener('click', handleAnswerClick));
                        modalStepsContainer.appendChild(stepDiv);
                        setTimeout(() => { stepDiv.classList.add('active'); }, 10); // Make active *after* appending

                    } else {
                        // All modal questions are done, now send the modal answers
                        console.log("All modal questions answered. Preparing modal answers payload.");

                        const modalQuestionResponsesText = [];
                        if (typeof collectedAnswers === 'object' && collectedAnswers !== null) {
                            for (const questionId in collectedAnswers) {
                                if (Object.hasOwnProperty.call(collectedAnswers, questionId)) {
                                    const answerValue = collectedAnswers[questionId];
                                    const questionObj = config.modalQuestions.find(q => q.id === questionId);
                                    if (questionObj) {
                                        const optionObj = questionObj.options.find(opt => opt.value === answerValue);
                                        modalQuestionResponsesText.push({
                                            question: questionObj.questionText,
                                            answer: optionObj ? optionObj.text : answerValue // Fallback to raw value
                                        });
                                    } else {
                                        console.warn(`Question ID "${questionId}" not found in config.modalQuestions during modal answer processing.`);
                                    }
                                }
                            }
                        }

                        // Construct the comprehensive payload for modal answers
                        const modalAnswersPayload = {
                            ...(storedInitialPayload || {}),      // Spread fields from stored initial payload
                            formType: "modal_answers",            // Override formType
                            submittedAt: new Date().toISOString(), // Update timestamp for this event
                            questions: modalQuestionResponsesText // Add the processed modal questions
                        };
                        
                        // Safety check: If storedInitialPayload was somehow null, log an error but proceed
                        if (!storedInitialPayload) {
                             console.error("CRITICAL: storedInitialPayload was null when constructing modal_answers payload. Sending potentially incomplete data.");
                             // The payload will still be sent, but might lack initial contact/deployment info.
                             // The formType will indicate it's modal_answers.
                        }


                        const visitorUrl = config.settings.visitorWebhookUrl;
                        if (visitorUrl) {
                            console.log(`Sending modal answers data to webhook: ${visitorUrl}`);
                            console.log('Modal Answers Payload:', JSON.stringify(modalAnswersPayload, null, 2));
                            try {
                                const response = await fetch(visitorUrl, {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(modalAnswersPayload),
                                    mode: 'cors'
                                });
                                if (!response.ok) {
                                    console.warn('Modal answers webhook failure:', response.status, await response.text());
                                } else {
                                    console.log('Modal answers webhook success!');
                                }
                            } catch (error) {
                                console.error('Modal answers webhook error:', error);
                            }
                        } else {
                            console.log("No webhook URL for modal answers. Skipping submission.");
                        }

                        // Proceed to show the final "Thank You" message
                        console.log("Showing final step (Thank You message)");
                        setTextContent('modalAddress', `${config.property.streetAddress}, ${config.property.city}`);
                        setTextContent('modalRealtorName', config.realtor.fullName);
                        modalStepFinal.style.display = 'block'; // Make final step visible
                        setTimeout(() => { modalStepFinal.classList.add('active'); }, 10); // Add active class
                        fireCoolConfetti();
                    }
                } catch(error) { console.error(`Error displaying modal step ${stepIndex}:`, error); hideSuccessModal(); }
            }

            function handleAnswerClick(event) {
                 console.log("Answer click handled");
                 try {
                     const button = event.currentTarget;
                     const stepIndex = parseInt(button.dataset.step, 10);
                     const questionId = button.dataset.questionId;
                     const answerValue = button.dataset.answer;
                     if (isNaN(stepIndex)) { console.error("Invalid step index"); return; }

                     collectedAnswers[questionId] = answerValue;
                     console.log('Collected Answers:', collectedAnswers);

                     const currentStep = document.getElementById(`modal-step-${questionId}`);
                     if (currentStep) {
                         currentStep.querySelectorAll('button').forEach(btn => btn.disabled = true);
                         button.style.borderColor = 'var(--primary-color)'; button.style.backgroundColor = 'rgba(224, 197, 143, 0.2)';

                         // Optional fade out before showing next
                         const activeStep = modalStepsContainer.querySelector('.modal-step.active');
                         if (activeStep) {
                              activeStep.style.transition = 'opacity 0.3s ease-out';
                              activeStep.style.opacity = '0';
                              setTimeout(() => displayModalStep(stepIndex + 1), 300);
                          } else {
                               setTimeout(() => displayModalStep(stepIndex + 1), 300); // Fallback delay
                          }

                     } else { console.warn(`Could not find step ${questionId} to disable buttons.`); setTimeout(() => displayModalStep(stepIndex + 1), 300); }
                 } catch (error) { console.error("Error handling answer click:", error); hideSuccessModal(); }
             }

            // --- Modal Control Functions ---
             function showQuestionnaireModal() {
                 console.log("showQuestionnaireModal called");
                 if (!successModalOverlay) { console.error("Modal overlay element not found!"); if (submitButton) { submitButton.disabled = false; submitButton.classList.remove('loading'); } return; }
                 currentStepIndex = 0; collectedAnswers = {};
                 if(modalStepsContainer) modalStepsContainer.innerHTML = '';
                 if(modalStepFinal) modalStepFinal.style.display = 'none'; modalStepFinal.classList.remove('active');

                 successModalOverlay.classList.add('visible');
                 console.log("Overlay class 'visible' added.");
                 setTimeout(() => displayModalStep(currentStepIndex), 50); // Display first step
             }

             function hideSuccessModal() {
                 console.log("hideSuccessModal called");
                 if(!successModalOverlay) return;
                 successModalOverlay.classList.remove('visible');
                 setTimeout(() => {
                    signInForm?.reset();
                    if (submitButton) {
                        submitButton.disabled = false; submitButton.classList.remove('loading');
                        const textSpan = submitButton.querySelector('.button-text');
                        if (textSpan) { textSpan.textContent = "Request My Home &amp; Neighbourhood Info Package"; }
                        else if (!submitButton.querySelector('.button-text')) { submitButton.innerHTML = '<span class="button-text">Request My Compendium</span><div class="spinner"></div>'; }
                    }
                    if(modalStepsContainer) modalStepsContainer.innerHTML = '';
                    if(modalStepFinal) { modalStepFinal.style.display = 'none'; modalStepFinal.classList.remove('active'); }
                 }, 400);
             }

            // --- Event Listeners for Modal ---
             if (modalCloseBtn) { modalCloseBtn.addEventListener('click', hideSuccessModal); }
             if (successModalOverlay) { successModalOverlay.addEventListener('click', (event) => { if (event.target === successModalOverlay) { hideSuccessModal(); } }); }
             document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && successModalOverlay?.classList.contains('visible')) { hideSuccessModal(); } });


            // --- Sign In Form Submission Logic ---
            if (signInForm && submitButton) {
                signInForm.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    submitButton.disabled = true; submitButton.classList.add('loading');
                    // Stage 1: Initial Contact Submission
                    const fullName = document.getElementById('fullName').value;
                    const email = document.getElementById('email').value;
                    const phone = document.getElementById('phone').value;
                    const propertyAddress = `${config.property.streetAddress}, ${config.property.cityStateZip}`;
                    const submittedAt = new Date().toISOString();

                    // Construct initialPayload
                    const initialPayload = {
                        formType: "initial_contact",
                        email: email,
                        fullName: fullName,
                        phone: phone,
                        propertyAddress: propertyAddress,
                        submittedAt: submittedAt,
                        questions: [], // Empty for initial contact
                        agentEmail: config.realtor.email, // Add agent email
                        ...(config.deploymentInfo || {})
                    };
                    
                    storedInitialPayload = initialPayload; // Store the entire initial payload

                    const visitorUrl = config.settings.visitorWebhookUrl;
                    if (visitorUrl) {
                        console.log(`Sending initial contact data to webhook: ${visitorUrl}`);
                        console.log('Initial Payload:', JSON.stringify(initialPayload, null, 2));
                        try {
                            // Not strictly awaiting here to show modal faster, but errors won't be caught to prevent modal.
                            // For robust error handling that stops flow, `await` this.
                            fetch(visitorUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(initialPayload),
                                mode: 'cors'
                            }).then(async response => {
                                if (!response.ok) {
                                    console.warn('Initial contact webhook failure:', response.status, await response.text());
                                } else {
                                    console.log('Initial contact webhook success!');
                                }
                            }).catch(error => {
                                console.error('Initial contact webhook error:', error);
                            });
                        } catch (error) { // This catch might not be effective if fetch isn't awaited
                            console.error('Outer error during initial contact submission:', error);
                        }
                    } else {
                        console.log("No visitor webhook URL. Skipping initial contact submission.");
                    }

                    // Proceed to show the modal questionnaire
                    showQuestionnaireModal();
                    // The submitButton state is reset by hideSuccessModal or when showQuestionnaireModal is called.
                });
             } else { console.error("Sign in form or submit button not found!"); }

        });
    </script>

</body>
</html>